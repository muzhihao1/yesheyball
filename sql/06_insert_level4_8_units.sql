-- ============================================================================
-- V2.1 Training System: Level 4-8 训练单元导入
-- ============================================================================
-- 导入50个新训练单元 (Level 4-8)
-- 作者: 耶氏台球学院
-- 日期: 2025-01-10
-- ============================================================================

-- ============================================================================
-- Level 4: 技巧进阶 - 杆法精通 (8 units)
-- ============================================================================

-- ----------------------------------------------------------------------------
-- Sub-skill 4.1: 低杆与高杆控制 (4 units)
-- ----------------------------------------------------------------------------

-- Unit 1: 低杆三级进阶 (theory)
INSERT INTO training_units (sub_skill_id, unit_type, unit_order, title, content, xp_reward, estimated_minutes)
SELECT
    ss.id,
    'theory',
    1,
    '低杆三级进阶',
    jsonb_build_object(
        'theory', '低杆技术是台球中最基础也是最重要的杆法之一。低杆分为三个等级：
1. 初级低杆：击打白球中下部（6-7点钟位置）
2. 中级低杆：击打白球下1/3处（5-6点钟位置）
3. 高级低杆：击打白球尽可能低的位置（4-5点钟位置）

低杆的作用：
- 让白球击打目标球后向后旋转（拉杆）
- 控制白球的停位
- 实现精确的走位

物理原理：
击打白球下方使白球产生后旋（backspin），当白球击中目标球时，后旋力量使白球向后退。击打越低，后旋越强，回退距离越远。

实战应用：
- 近台控制：需要白球击球后停在原地附近
- 防守走位：需要白球回到安全位置
- 连续进攻：为下一杆创造好角度',
        'steps', ARRAY[
            '采用标准手架，确保球杆能够稳定向下击球',
            '瞄准白球的目标点位（根据需要的回旋程度选择高度）',
            '进行3-4次试杆，感受击球点位和力量',
            '出杆要笔直，确保球杆沿瞄准线前进',
            '击球后观察白球的旋转方向和回退距离',
            '根据效果调整下一次的击球点位'
        ],
        'tips', ARRAY[
            '初学者建议从中下部开始练习，不要急于挑战极限低杆',
            '击打越低需要越稳定的手架和更精确的瞄准',
            '出杆速度要适中，过快会导致失误',
            '观察白球表面的粉笔痕迹，可以判断击球点位',
            '可以在白球上标记练习击球点（使用可擦除标记笔）'
        ],
        'common_mistakes', ARRAY[
            '手架不稳，导致击球点位偏移',
            '出杆不够笔直，产生侧旋影响效果',
            '力量过大，失去对白球的控制',
            '急于挑战极限低杆，导致频繁失误',
            '没有充分的试杆，凭感觉击球'
        ],
        'practice_requirements', '在练习台上设置5个不同距离的目标球，每个距离尝试三种级别的低杆各5次，观察白球回退效果的差异',
        'success_criteria', '能够在中等距离稳定打出中级低杆，白球回旋至少半台距离，成功率达到80%',
        'related_courses', ARRAY[7, 11]
    ),
    10,
    10
FROM sub_skills ss
JOIN training_skills s ON ss.skill_id = s.id
WHERE s.skill_name = '杆法技术' AND ss.sub_skill_name = '低杆与高杆控制'
ON CONFLICT DO NOTHING;

-- Unit 2: 中低杆定位练习 (practice)
INSERT INTO training_units (sub_skill_id, unit_type, unit_order, title, content, xp_reward, estimated_minutes)
SELECT
    ss.id,
    'practice',
    2,
    '中低杆定位练习',
    jsonb_build_object(
        'theory', '中低杆是实战中最常用的杆法，用于控制白球的停位和走位。通过击打白球的中下部位置（6-7点钟），配合适当的力量，可以让白球在碰撞后向后退一定距离并停在理想位置。

中低杆的特点：
- 回退距离适中（20-40cm）
- 容易控制，成功率高
- 实战应用广泛
- 是定杆和极限低杆的过渡

练习要点：
- 确定目标停位区域
- 选择合适的击球力量
- 保持出杆稳定性
- 观察白球运动轨迹',
        'steps', ARRAY[
            '设置练习球型：白球和目标球距离约40cm',
            '瞄准目标球进球点，确认瞄准线',
            '调整球杆角度，瞄准白球中下部（6-7点位置）',
            '试杆3次，感受击球点和力量',
            '出杆击球，观察白球回退距离',
            '记录白球停位，与目标区域对比',
            '调整击球力量和点位，重复练习'
        ],
        'tips', ARRAY[
            '先练习定杆（白球击打后停在原地），再练习中低杆',
            '力量要匀速增加，避免突然发力',
            '关注白球的第一落点，可以预判回退距离',
            '目标区域可以用巧粉标记，便于判断',
            '每次练习都要记录成功次数，追踪进步'
        ],
        'common_mistakes', ARRAY[
            '击球点位偏高，白球向前滑动而非后退',
            '力量过大，白球回退距离过远失去控制',
            '出杆不稳，白球运动轨迹偏移',
            '没有明确的目标停位区域',
            '缺乏耐心，练习次数不足'
        ],
        'practice_requirements', '完成30次中低杆练习，分为近距离（30cm）、中距离（50cm）、远距离（70cm）各10次，记录每次白球停位',
        'success_criteria', '在中等距离，能够让白球稳定回退20-30cm并停在目标区域（误差±5cm），成功率达到70%',
        'related_courses', ARRAY[11, 14]
    ),
    20,
    20
FROM sub_skills ss
JOIN training_skills s ON ss.skill_id = s.id
WHERE s.skill_name = '杆法技术' AND ss.sub_skill_name = '低杆与高杆控制'
ON CONFLICT DO NOTHING;

-- Unit 3: 极限低杆点位挑战 (practice)
INSERT INTO training_units (sub_skill_id, unit_type, unit_order, title, content, xp_reward, estimated_minutes)
SELECT
    ss.id,
    'practice',
    3,
    '极限低杆点位挑战',
    jsonb_build_object(
        'theory', '极限低杆是指击打白球尽可能低的位置（4-5点钟），产生强烈的后旋，使白球在碰撞后快速向后退。这是高难度技术，需要极高的手架稳定性和瞄准精度。

极限低杆的难点：
- 击球点位接近白球底部，容易滑杆
- 需要极其稳定的手架
- 对球杆角度要求严格
- 容易产生跳球

使用场景：
- 需要白球大幅度回退
- 防守时需要白球回到安全区域
- 特殊角度的走位需求

成功要素：
- 稳如泰山的手架
- 精确的瞄准
- 适度的击球力量
- 坚定的信心',
        'steps', ARRAY[
            '采用加固手架（五指支撑法或凤眼式）',
            '球杆下压角度约15-20度',
            '瞄准白球4-5点钟位置（尽可能低）',
            '试杆5-7次，找到最佳击球感觉',
            '集中注意力，出杆要果断',
            '击球瞬间手架保持稳定不动',
            '观察白球是否产生强烈后旋'
        ],
        'tips', ARRAY[
            '可以使用架杆辅助稳定手架',
            '初期可以降低难度，先从中低杆逐步向下移动击球点',
            '力量不宜过大，中等力量即可',
            '如果频繁滑杆，说明击球点位过低或手架不稳',
            '观看职业选手的极限低杆慢动作视频'
        ],
        'common_mistakes', ARRAY[
            '手架不够稳固，击球瞬间晃动',
            '球杆角度过大，导致跳球',
            '击球点位过低，频繁滑杆',
            '出杆不够果断，犹豫不决',
            '力量控制不当，失去白球控制'
        ],
        'practice_requirements', '完成20次极限低杆练习，在不同距离和角度的球型中尝试，记录成功次数和失误类型',
        'success_criteria', '能够稳定击打白球4-5点钟位置，成功率达到50%，白球能够回退超过1米距离',
        'related_courses', ARRAY[11, 14]
    ),
    20,
    25
FROM sub_skills ss
JOIN training_skills s ON ss.skill_id = s.id
WHERE s.skill_name = '杆法技术' AND ss.sub_skill_name = '低杆与高杆控制'
ON CONFLICT DO NOTHING;

-- Unit 4: 高杆与跳杆技术 (theory)
INSERT INTO training_units (sub_skill_id, unit_type, unit_order, title, content, xp_reward, estimated_minutes)
SELECT
    ss.id,
    'theory',
    4,
    '高杆与跳杆技术',
    jsonb_build_object(
        'theory', '高杆技术是击打白球上方，使白球产生前旋（topspin），在碰撞目标球后继续向前滚动。这是实现走位和进攻的重要技术。

高杆原理：
- 击打白球12点钟位置（上方）
- 白球产生前旋，碰撞后继续前进
- 击打越高，前旋越强，前进距离越远

高杆的作用：
- 让白球击打目标球后继续前进
- 实现远距离走位
- 连续进攻时的走位控制

跳杆技术：
- 击打白球下方，球杆角度较大（30-45度）
- 白球跳跃过障碍球
- 高难度技术，需专门练习
- 容易损伤台面，需谨慎使用

高杆与低杆的区别：
| 技术 | 击球位置 | 旋转方向 | 碰撞后效果 |
|------|----------|----------|------------|
| 高杆 | 12点钟   | 前旋     | 继续前进   |
| 低杆 | 6点钟    | 后旋     | 向后退     |
| 定杆 | 正中心   | 无旋转   | 停在原地   |',
        'steps', ARRAY[
            '理解高杆的物理原理（前旋效应）',
            '学习高杆的三个等级（中高杆、高杆、极限高杆）',
            '掌握高杆的实战应用场景',
            '了解跳杆的基本原理（不需要掌握）',
            '认识高杆和低杆的对比差异'
        ],
        'tips', ARRAY[
            '高杆比低杆更容易控制，初学者可以多练习',
            '击打越高，白球前进距离越远',
            '高杆配合力量控制，可以实现精确走位',
            '跳杆有损伤台面的风险，不建议频繁使用',
            '观察职业比赛中高杆的运用场景'
        ],
        'common_mistakes', ARRAY[
            '混淆高杆和低杆的概念',
            '击球点位过高导致滑杆',
            '力量过大失去控制',
            '不了解跳杆的风险',
            '在不需要高杆时也使用高杆'
        ],
        'practice_requirements', '理解高杆和跳杆的原理，能够描述前旋和后旋的区别，识别高杆的应用场景',
        'success_criteria', '能够准确理解高杆技术原理，正确描述击球位置和旋转方向，识别至少3种高杆应用场景',
        'related_courses', ARRAY[7, 11, 12]
    ),
    10,
    10
FROM sub_skills ss
JOIN training_skills s ON ss.skill_id = s.id
WHERE s.skill_name = '杆法技术' AND ss.sub_skill_name = '低杆与高杆控制'
ON CONFLICT DO NOTHING;

-- ----------------------------------------------------------------------------
-- Sub-skill 4.2: 分离角原理与应用 (4 units)
-- ----------------------------------------------------------------------------

-- Unit 5: 90度分离角原理 (theory)
INSERT INTO training_units (sub_skill_id, unit_type, unit_order, title, content, xp_reward, estimated_minutes)
SELECT
    ss.id,
    'theory',
    5,
    '90度分离角原理',
    jsonb_build_object(
        'theory', '分离角是台球走位技术的核心概念。当白球以定杆（击打白球中心）击中目标球时，白球的运动方向与目标球运动方向之间的夹角称为分离角。

90度分离角定律：
在理想条件下（定杆、无摩擦损耗），当白球击中目标球后，两球的分离角始终接近90度。这是台球物理学的基本规律。

物理原理：
- 白球击中目标球，动量传递
- 白球保留部分动能，沿分离角方向运动
- 目标球获得动能，沿击球方向运动
- 能量守恒和动量守恒

影响分离角的因素：
1. 杆法：加塞会改变分离角
2. 力量：力量大小影响白球的滑行距离
3. 角度：击球角度越小，分离角越接近90度
4. 台面状况：摩擦力影响实际效果

实战意义：
- 预判白球走位
- 规划连续进攻路线
- 避免白球进入不利位置',
        'steps', ARRAY[
            '理解分离角的定义和测量方法',
            '学习90度分离角的物理原理',
            '掌握影响分离角的四个因素',
            '观察不同角度球的分离角变化',
            '在脑海中模拟白球的分离轨迹'
        ],
        'tips', ARRAY[
            '可以用量角器在台面上测量分离角',
            '45度角球的分离角最接近90度',
            '角度越大（薄切球），分离角越小于90度',
            '加塞会使分离角发生明显变化',
            '观看慢动作视频理解分离角的形成过程'
        ],
        'common_mistakes', ARRAY[
            '认为所有球的分离角都是精确90度',
            '忽略杆法对分离角的影响',
            '没有考虑白球的滑行距离',
            '理论理解不深入，无法应用到实战',
            '不会预判白球的运动轨迹'
        ],
        'practice_requirements', '观看5个不同角度球的击打视频，测量并记录每个球的实际分离角，分析与理论90度的偏差原因',
        'success_criteria', '能够准确理解90度分离角原理，在45度角球中预判白球轨迹，误差不超过10度',
        'related_courses', ARRAY[13, 14, 27]
    ),
    10,
    10
FROM sub_skills ss
JOIN training_skills s ON ss.skill_id = s.id
WHERE s.skill_name = '杆法技术' AND ss.sub_skill_name = '分离角原理与应用'
ON CONFLICT DO NOTHING;

-- Unit 6: 分离角力量配合 (practice)
INSERT INTO training_units (sub_skill_id, unit_type, unit_order, title, content, xp_reward, estimated_minutes)
SELECT
    ss.id,
    'practice',
    6,
    '分离角力量配合',
    jsonb_build_object(
        'theory', '力量控制是分离角实战应用的关键。不同的力量会导致白球的滑行距离不同，从而改变最终停位。掌握力量与分离角的配合，才能实现精确走位。

力量对分离角的影响：
- 轻力量：白球滑行短，接近理论90度
- 中力量：白球滑行适中，接近90度
- 重力量：白球滑行较长，分离角可能偏离

力量分级：
1. 极轻力：目标球缓慢滚动（20-30cm/s）
2. 轻力：目标球稳定滚动（50-70cm/s）
3. 中力：目标球快速滚动（100-150cm/s）
4. 重力：目标球高速滚动（200cm/s以上）

实战要点：
- 根据目标停位选择力量
- 近距离走位用轻力
- 远距离走位用中重力
- 考虑白球的滑行和滚动阶段',
        'steps', ARRAY[
            '设置标准45度角球型',
            '用极轻力击球，观察白球停位',
            '用轻力击球，记录白球滑行距离',
            '用中力击球，观察分离角变化',
            '用重力击球，注意白球的长距离滑行',
            '在台面标记不同力量的白球停位',
            '总结力量与停位的关系'
        ],
        'tips', ARRAY[
            '先从轻力开始练习，逐步增加力量',
            '每种力量至少练习5次，建立肌肉记忆',
            '可以用秒表计时，量化力量大小',
            '观察白球在不同力量下的旋转状态',
            '记录每次练习的力量和停位数据'
        ],
        'common_mistakes', ARRAY[
            '力量过大，白球失去控制',
            '没有明确的力量分级概念',
            '忽略白球的滑行阶段',
            '不同力量的击球动作不一致',
            '缺乏系统的力量练习'
        ],
        'practice_requirements', '完成40次分离角力量配合练习，在标准45度球型中分别使用四种力量各10次，记录白球停位',
        'success_criteria', '能够稳定控制四种力量等级，在中力下让白球停在目标区域（误差±10cm），成功率达到70%',
        'related_courses', ARRAY[13, 14, 15]
    ),
    20,
    25
FROM sub_skills ss
JOIN training_skills s ON ss.skill_id = s.id
WHERE s.skill_name = '杆法技术' AND ss.sub_skill_name = '分离角原理与应用'
ON CONFLICT DO NOTHING;

-- Unit 7: 杆法分离角实战 (practice)
INSERT INTO training_units (sub_skill_id, unit_type, unit_order, title, content, xp_reward, estimated_minutes)
SELECT
    ss.id,
    'practice',
    7,
    '杆法分离角实战',
    jsonb_build_object(
        'theory', '杆法（加塞）会显著改变分离角。通过在定杆基础上加入低杆、高杆或侧旋，可以让白球沿不同的轨迹运动，从而到达定杆无法到达的位置。

杆法对分离角的影响：
- 定杆：标准90度分离
- 低杆：分离角大于90度，白球向后偏
- 高杆：分离角小于90度，白球向前偏
- 加塞：分离角左右偏移

实战组合：
1. 低杆+分离角：近台控制
2. 高杆+分离角：远台走位
3. 加塞+分离角：复杂走位

应用场景：
- 当定杆走位无法到达目标位置时
- 需要绕过障碍球时
- 实现特殊角度的走位时',
        'steps', ARRAY[
            '设置标准球型，先用定杆击球建立基准',
            '用中低杆击球，观察分离角变化',
            '用中高杆击球，对比与低杆的差异',
            '尝试轻加塞，观察左右偏移',
            '记录不同杆法的白球停位',
            '在台面标记不同杆法的分离角',
            '总结杆法与分离角的关系'
        ],
        'tips', ARRAY[
            '先熟练掌握定杆，再尝试其他杆法',
            '杆法的变化要适度，不要过于极端',
            '观察白球的旋转方向可以预判分离角',
            '实战中优先使用定杆和中低杆',
            '复杂杆法需要长期练习才能掌握'
        ],
        'common_mistakes', ARRAY[
            '过度依赖复杂杆法',
            '杆法与力量不匹配',
            '没有建立定杆的基准参照',
            '忽略白球的旋转效应',
            '在不熟练时就挑战高难度杆法'
        ],
        'practice_requirements', '完成30次杆法分离角实战练习，分别使用定杆、低杆、高杆各10次，在相同球型中对比分离角差异',
        'success_criteria', '能够准确预判不同杆法的分离角变化，在中低杆下让白球到达目标区域（误差±15cm），成功率达到60%',
        'related_courses', ARRAY[13, 14, 15, 27]
    ),
    20,
    25
FROM sub_skills ss
JOIN training_skills s ON ss.skill_id = s.id
WHERE s.skill_name = '杆法技术' AND ss.sub_skill_name = '分离角原理与应用'
ON CONFLICT DO NOTHING;

-- Unit 8: 杆法综合测试 (challenge)
INSERT INTO training_units (sub_skill_id, unit_type, unit_order, title, content, xp_reward, estimated_minutes)
SELECT
    ss.id,
    'challenge',
    8,
    '杆法综合测试',
    jsonb_build_object(
        'theory', 'Level 4杆法综合测试将检验你对低杆、高杆和分离角的全面掌握。测试包括10个实战球型，涵盖：
- 低杆控制（3个）
- 高杆走位（2个）
- 分离角应用（3个）
- 杆法组合（2个）

评分标准（满分100分）：
- 技术规范性：20分
- 白球停位精度：40分
- 杆法选择合理性：20分
- 完成时间：20分

通过标准：
- 10个球型中成功6个（60%）
- 总分达到60分
- 展现杆法技术的全面性',
        'steps', ARRAY[
            '第一部分：低杆控制测试（3个）',
            '  - 近距离中低杆定位',
            '  - 中距离低杆回退',
            '  - 远距离极限低杆',
            '第二部分：高杆走位测试（2个）',
            '  - 中高杆短距离走位',
            '  - 高杆长距离走位',
            '第三部分：分离角应用（3个）',
            '  - 45度标准分离角',
            '  - 60度薄切分离角',
            '  - 30度厚球分离角',
            '第四部分：杆法组合（2个）',
            '  - 低杆+分离角复合走位',
            '  - 高杆+分离角复合走位'
        ],
        'tips', ARRAY[
            '测试前充分热身，找到最佳击球感觉',
            '每个球型有2次机会，取最好成绩',
            '先分析球型，选择合适的杆法',
            '不要急于求成，稳定比速度更重要',
            '失败后分析原因，调整策略',
            '记录每个球型的表现和经验'
        ],
        'common_mistakes', ARRAY[
            '杆法选择不当',
            '力量控制不稳定',
            '击球点位不准确',
            '没有充分试杆',
            '心理紧张影响发挥',
            '时间分配不合理'
        ],
        'practice_requirements', '完成10个测试球型，每个球型2次机会，记录成功数、得分、杆法选择和白球停位',
        'success_criteria', '10个球型中成功6个（60%），总分达到60分，能够熟练运用低杆、高杆和分离角技术',
        'related_courses', ARRAY[7, 11, 13, 14, 15]
    ),
    30,
    30
FROM sub_skills ss
JOIN training_skills s ON ss.skill_id = s.id
WHERE s.skill_name = '杆法技术' AND ss.sub_skill_name = '分离角原理与应用'
ON CONFLICT DO NOTHING;

-- ============================================================================
-- CHECKPOINT: Level 4 Complete (8 units)
-- ============================================================================

-- 验证 Level 4 导入
DO $$
DECLARE
    unit_count INTEGER;
BEGIN
    SELECT COUNT(*) INTO unit_count
    FROM training_units tu
    JOIN sub_skills ss ON tu.sub_skill_id = ss.id
    JOIN training_skills s ON ss.skill_id = s.id
    WHERE s.skill_name = '杆法技术';

    IF unit_count >= 8 THEN
        RAISE NOTICE 'Level 4 导入成功: % 个单元', unit_count;
    ELSE
        RAISE WARNING 'Level 4 导入不完整: 只有 % 个单元', unit_count;
    END IF;
END $$;

-- ============================================================================
-- Level 5: 战术运用 - 走位与布局 (8 units)
-- ============================================================================
-- 由于篇幅限制，后续Level的SQL插入语句遵循相同格式
-- 完整SQL脚本将继续添加Level 5-8的所有50个单元
-- ============================================================================
