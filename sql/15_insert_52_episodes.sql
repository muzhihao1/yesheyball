-- ============================================================================
-- Migration 15: 插入52集完整课程到training_days表
-- 基于王孟52集台球教学课程（来自server/dailyCourses.ts）
-- 这些课程将用于90天系统训练的详细内容映射
-- ============================================================================

-- 步骤1: 检查training_programs表中是否存在"耶氏台球学院系统教学"
-- 如果不存在，先创建该训练计划
INSERT INTO training_programs (name, description, total_days, current_day, difficulty, created_at)
SELECT
    '耶氏台球学院系统教学（52集完整版）',
    '基于王孟52集台球教学课程的系统化训练计划，从握杆、站位到实战清台的全面指导',
    52,
    1,
    '新手',
    NOW()
WHERE NOT EXISTS (
    SELECT 1 FROM training_programs
    WHERE name = '耶氏台球学院系统教学（52集完整版）'
);

-- 步骤2: 插入52集完整课程数据
-- 注意：这里使用ON CONFLICT DO NOTHING避免重复插入
INSERT INTO training_days (program_id, day, title, description, objectives, key_points, estimated_duration, video_url, created_at)
SELECT
    (SELECT id FROM training_programs WHERE name = '耶氏台球学院系统教学（52集完整版）' LIMIT 1),
    day,
    title,
    description,
    ARRAY[description]::text[], -- objectives从description生成
    ARRAY['参考视频教学', '按照标准动作练习', '重点掌握核心要点']::text[], -- 默认key_points
    CASE
        WHEN day <= 7 THEN 30
        WHEN day <= 14 THEN 40
        WHEN day <= 28 THEN 45
        ELSE 50
    END, -- estimated_duration根据难度递增
    NULL, -- video_url暂时为空
    NOW()
FROM (VALUES
    -- 第1周：基础姿势与握杆
    (1, '第1集：握杆基础训练', '学习正确的握杆姿势，建立良好的击球基础。重点掌握握杆的力度和位置。'),
    (2, '第2集：手架技术练习', '掌握稳定的手架技术，为精准击球做准备。练习不同距离的手架摆放。'),
    (3, '第3集：站位与姿势调整', '学习正确的站位和身体姿势，建立稳定的击球平台。'),
    (4, '第4集：入位与击球节奏', '培养良好的入位习惯和击球节奏，提高击球的一致性。'),
    (5, '第5集：空杆与节奏训练', '通过空杆练习建立稳定的击球节奏，培养肌肉记忆。'),
    (6, '第6集：初级瞄准技术', '学习基础瞄准技术，掌握瞄准线的概念和应用。'),
    (7, '第7集：低杆发力平稳度', '练习低杆技术，重点掌握发力的平稳度和控制。'),

    -- 第2周：力量控制与穿透力
    (8, '第8集：穿透力训练', '学习通过手肘动作增加穿透力，提高击球效果。'),
    (9, '第9集：初级预力控制', '掌握基础的力量控制技术，学会判断和调节击球力度。'),
    (10, '第10集：中级预力锁定', '通过试杆练习锁定合适的击球力量，提高击球精度。'),
    (11, '第11集：低杆力量控制', '在低杆击球中运用力量控制技术，掌握精确的力度调节。'),
    (12, '第12集：翻腕技术训练', '练习手腕翻转技术，提高击球的稳定性和精确性。'),
    (13, '第13集：满弓发力训练', '学习满弓发力技术，掌握大力击球的要领。'),
    (14, '第14集：长台分段发力1', '在长台球中练习分段发力，掌握中低杆的运用。'),

    -- 第3周：高级发力与瞄准
    (15, '第15集：长台分段发力2', '进一步练习长台低杆的分段发力技术。'),
    (16, '第16集：极限低杆点位', '挑战极限低杆点位的分段发力，突破技术极限。'),
    (17, '第17集：重心线训练', '通过重心线训练提高直球分点能力。'),
    (18, '第18集：假想球瞄准法', '学习假想球瞄准方法，提高瞄准精度。'),
    (19, '第19集：向边球瞄准', '练习向边球的瞄准技术，掌握角度球基础。'),
    (20, '第20集：离边球瞄准', '掌握离边球的瞄准方法，完善角度球技术。'),
    (21, '第21集：中袋球训练', '专门练习中袋球技术，提高中袋进球率。'),

    -- 第4周：高级瞄准与分离角
    (22, '第22集：极限高球瞄准', '挑战极限高球的瞄准，突破技术难点。'),
    (23, '第23集：中级瞄准锁定', '学习锁定进球点的中级瞄准技术。'),
    (24, '第24集：90度分离角', '练习90度分离角技术，掌握标准分离角。'),
    (25, '第25集：力量配合击球点', '学习不同力量配合击球点位的分离角技术。'),
    (26, '第26集：登杆分离角', '掌握登杆配合分离角的高级技术。'),
    (27, '第27集：不吃库走位', '练习不吃库的走位技术，掌握直接走位。'),
    (28, '第28集：一库走位技术', '学习一库走位技术并进行拆解练习。'),

    -- 第5周：加塞技术
    (29, '第29集：加塞身位夹角', '练习加塞时身位与球杆的夹角调整。'),
    (30, '第30集：5分点加塞训练', '通过5分点训练掌握加塞瞄准技术。'),
    (31, '第31集：角度球加塞', '学习角度球的加塞瞄准技术。'),
    (32, '第32集：顺塞走位', '练习顺塞的走位技术，掌握顺塞运用。'),
    (33, '第33集：反塞走位', '掌握反塞的走位技术，完善加塞体系。'),
    (34, '第34集：清台思路', '学习清台的基本思路和策略规划。'),
    (35, '第35集：实战清台1', '实战清台练习第一阶段，应用基础技术。'),

    -- 第6周：实战清台训练
    (36, '第36集：实战清台2', '实战清台练习第二阶段，提高成功率。'),
    (37, '第37集：实战清台3', '实战清台练习第三阶段，挑战复杂球局。'),
    (38, '第38集：实战清台4', '实战清台练习第四阶段，提升技术水平。'),
    (39, '第39集：实战清台5', '实战清台练习第五阶段，巩固所学技术。'),
    (40, '第40集：实战清台6', '实战清台练习第六阶段，达到高水平运用。'),
    (41, '第41集：弧线球技术', '学习弧线球技术，掌握特殊击球方法。'),
    (42, '第42集：分离角原理', '深入理解白球分离角的物理原理。'),

    -- 第7周：理论与日常训练
    (43, '第43集：清台思路讲解', '学习初级清台的思路和方法论。'),
    (44, '第44集：肌肉激活训练1', '第一套激活肌肉状态的练习方法。'),
    (45, '第45集：肌肉激活训练2', '第二套激活肌肉状态的练习方法。'),
    (46, '第46集：肌肉激活训练3', '第三套激活肌肉状态的练习方法。'),
    (47, '第47集：肌肉激活训练4', '第四套激活肌肉状态的练习方法。'),
    (48, '第48集：肌肉激活训练5', '第五套激活肌肉状态的练习方法。'),
    (49, '第49集：肌肉激活训练6', '第六套激活肌肉状态的练习方法。'),

    -- 第8周：节奏掌握与综合运用
    (50, '第50集：出杆节奏训练1', '通过节奏训练快速提升技术水平。'),
    (51, '第51集：出杆节奏训练2', '进一步掌握出杆节奏的要领和应用。'),
    (52, '第52集：综合技术运用', '综合运用所学技术进行实战练习，达成技术整合。')
) AS courses(day, title, description)
ON CONFLICT (program_id, day) DO NOTHING;

-- 步骤3: 验证插入结果
SELECT
    '插入验证' as check_type,
    COUNT(*) as episode_count,
    MIN(day) as min_day,
    MAX(day) as max_day
FROM training_days
WHERE program_id = (SELECT id FROM training_programs WHERE name = '耶氏台球学院系统教学（52集完整版）' LIMIT 1);

-- 步骤4: 显示所有52集课程
SELECT
    day as "集数",
    title as "标题",
    LEFT(description, 50) || '...' as "简介",
    estimated_duration as "时长(分钟)"
FROM training_days
WHERE program_id = (SELECT id FROM training_programs WHERE name = '耶氏台球学院系统教学（52集完整版）' LIMIT 1)
ORDER BY day;
