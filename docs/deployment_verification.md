# 部署验证和测试清单

## 📦 部署信息

**部署时间**: 2025-11-09
**Git Commits**:
- `3a1df47` - feat: integrate DailyGoalsPanel into main training interface
- `5180ef9` - feat(P3): implement complete daily goals system
- `44d3a48` - feat(P2-3): integrate achievement auto-unlock system

**部署平台**: Vercel
**数据库**: Supabase PostgreSQL

---

## ✅ 部署前检查清单

### 代码质量
- [x] TypeScript 编译通过 (`npm run check`)
- [x] 生产构建成功 (`npm run build`)
- [x] 无 ESLint 错误
- [x] Git 提交信息清晰

### 数据库
- [ ] 需要运行数据库迁移
- [ ] 初始化 Goal Templates: `POST /api/admin/init-goal-templates`
- [ ] 验证 Achievements 已初始化: `POST /api/admin/init-achievements`

### 环境变量 (Vercel)
- [ ] `DATABASE_URL` - Supabase Session Pooler
- [ ] `VITE_SUPABASE_URL`
- [ ] `VITE_SUPABASE_ANON_KEY`
- [ ] `SUPABASE_SERVICE_ROLE_KEY`
- [ ] `OPENAI_API_KEY`
- [ ] `SESSION_SECRET`

---

## 🧪 功能测试清单

### 1. 成就系统测试

#### 基础功能
- [ ] **首次训练**: 完成一次训练，验证"第一滴血"成就解锁
- [ ] **成就弹窗**: 验证 AchievementUnlockModal 显示
- [ ] **Confetti 动画**: 验证庆祝动画播放
- [ ] **经验奖励**: 验证成就解锁后经验值增加

#### 多成就测试
- [ ] 同时解锁多个成就（如首次训练时可能解锁2个）
- [ ] 验证 Previous/Next 导航按钮
- [ ] 验证进度指示器（X/Y 成就）

#### 成就流程
- [ ] 训练完成 → 评分 → AI反馈 → 成就解锁（正确顺序）
- [ ] 500ms 过渡延迟是否流畅

#### 数据持久化
- [ ] 刷新页面后成就仍然显示为已解锁
- [ ] 不会重复解锁同一成就

### 2. 每日目标系统测试

#### 基础功能
- [ ] **首次访问**: 自动生成3个每日目标
- [ ] **难度平衡**: 验证1个简单 + 1个中等 + 1个困难
- [ ] **目标显示**: DailyGoalsPanel 在 levels.tsx 正确渲染

#### 进度追踪
- [ ] **训练次数目标**: 完成训练后进度 +1
- [ ] **训练时长目标**: 累计分钟数正确
- [ ] **评分目标**: 达到指定评分后完成

#### 进度条和动画
- [ ] 进度条平滑动画（0 → X%）
- [ ] 完成时显示绿色背景和 CheckCircle 图标
- [ ] 所有目标完成后显示庆祝消息

#### 经验奖励
- [ ] 完成目标后经验值增加
- [ ] 奖励金额与难度匹配（EASY: 10, MEDIUM: 20, HARD: 30）

#### 数据刷新
- [ ] 完成训练后每日目标自动刷新
- [ ] 进度实时更新（通过 TanStack Query）

### 3. 集成测试

#### 完整用户流程
1. [ ] 登录系统
2. [ ] 查看每日目标（3个）
3. [ ] 开始训练（任意类型）
4. [ ] 完成训练并评分
5. [ ] 查看 AI 反馈
6. [ ] 查看成就解锁（如果有）
7. [ ] 返回主页，验证：
   - [ ] 每日目标进度更新
   - [ ] 经验值增加
   - [ ] 等级可能提升

#### 边界条件
- [ ] 第一次训练（应解锁"第一滴血"）
- [ ] 完成所有每日目标（显示庆祝）
- [ ] 连续训练（验证 streak 计算）
- [ ] 高评分训练（验证评分目标）

---

## 🔍 部署后验证步骤

### Step 1: 数据库初始化
```bash
# 1. 初始化成就（如果尚未初始化）
curl -X POST https://your-domain.vercel.app/api/admin/init-achievements

# 2. 初始化每日目标模板
curl -X POST https://your-domain.vercel.app/api/admin/init-goal-templates
```

预期响应:
```json
{
  "inserted": 8,
  "message": "Successfully initialized 8 goal templates"
}
```

### Step 2: 用户注册/登录
- [ ] 访问 `/login` 页面
- [ ] 注册新用户或使用现有账户登录
- [ ] 验证 Supabase Auth 正常工作

### Step 3: 验证每日目标 API
```bash
# 获取当前用户的每日目标
curl https://your-domain.vercel.app/api/goals/daily \
  -H "Cookie: your-session-cookie"
```

预期响应: 3个每日目标的数组

### Step 4: 完成一次训练
1. [ ] 进入 levels.tsx 或 tasks.tsx
2. [ ] 选择任意训练
3. [ ] 完成并评分（1-5星）
4. [ ] 观察流程:
   - [ ] 庆祝动画
   - [ ] AI反馈弹窗
   - [ ] 成就解锁弹窗（如果有）
   - [ ] 每日目标进度更新

### Step 5: 验证数据持久化
- [ ] 刷新页面
- [ ] 验证每日目标进度保持
- [ ] 验证成就状态保持
- [ ] 验证经验值和等级正确

---

## 📊 性能监控

### 关键指标
- [ ] 页面加载时间 < 3秒
- [ ] API 响应时间:
  - [ ] `/api/goals/daily` < 500ms
  - [ ] `/api/check-achievements` < 500ms
  - [ ] `/api/training-sessions` < 1000ms

### 错误监控
- [ ] 检查 Vercel Functions 日志
- [ ] 检查浏览器控制台错误
- [ ] 检查网络请求失败

### 数据库性能
- [ ] 查询延迟 < 100ms
- [ ] 连接池状态正常
- [ ] 无超时错误

---

## 🐛 已知问题和限制

### 当前限制
1. **每日目标重置**: 目前采用懒加载策略（用户首次访问时生成），没有午夜自动重置的 CRON 任务
2. **数据库迁移**: 需要手动运行初始化脚本
3. **图片上传**: Vercel Serverless 不支持持久化文件存储

### 待优化项
1. 添加目标完成动画效果
2. 添加周目标系统
3. 添加目标历史记录
4. 实现午夜自动重置

---

## 📝 测试记录

### 测试日期: ___________

#### 测试人员: ___________

#### 测试结果:

| 功能模块 | 测试项 | 状态 | 备注 |
|---------|-------|------|------|
| 成就系统 | 首次训练解锁 | ☐ 通过 / ☐ 失败 |  |
| 成就系统 | 多成就导航 | ☐ 通过 / ☐ 失败 |  |
| 成就系统 | 动画效果 | ☐ 通过 / ☐ 失败 |  |
| 每日目标 | 目标生成 | ☐ 通过 / ☐ 失败 |  |
| 每日目标 | 进度追踪 | ☐ 通过 / ☐ 失败 |  |
| 每日目标 | 经验奖励 | ☐ 通过 / ☐ 失败 |  |
| 集成测试 | 完整流程 | ☐ 通过 / ☐ 失败 |  |

#### 发现的问题:

1. ________________________________________________
2. ________________________________________________
3. ________________________________________________

#### 用户反馈:

- ________________________________________________
- ________________________________________________
- ________________________________________________

---

## ✅ 部署签收

- [ ] 所有测试项通过
- [ ] 性能指标达标
- [ ] 无严重错误
- [ ] 用户体验良好
- [ ] 数据库状态正常

**签收人**: ___________
**签收日期**: ___________

---

## 🚀 下一步行动

根据测试结果:

### 如果测试通过
1. [ ] 通知用户新功能上线
2. [ ] 收集用户反馈（1-2周）
3. [ ] 监控系统稳定性
4. [ ] 计划下一阶段开发（技能树/S1.1内容）

### 如果发现问题
1. [ ] 记录问题详情
2. [ ] 评估严重程度
3. [ ] 制定修复方案
4. [ ] 部署热修复
5. [ ] 重新测试

---

## 📧 联系方式

**技术支持**: ___________
**产品反馈**: ___________
**紧急问题**: ___________
