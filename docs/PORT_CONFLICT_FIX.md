# Port 5000 Conflict - macOS AirPlay Receiver

## é—®é¢˜

å¼€å‘æœåŠ¡å™¨æ— æ³•å¯åŠ¨ï¼Œæ˜¾ç¤ºé”™è¯¯ï¼š
```
Error: listen EADDRINUSE: address already in use 0.0.0.0:5000
```

åŸå› ï¼šmacOS çš„ **AirPlay Receiver** æœåŠ¡å ç”¨äº†ç«¯å£ 5000ã€‚

## è§£å†³æ–¹æ¡ˆï¼ˆé€‰æ‹©å…¶ä¸€ï¼‰

### æ–¹æ¡ˆ 1ï¼šå…³é—­ AirPlay Receiverï¼ˆæ¨èï¼‰

1. æ‰“å¼€ **ç³»ç»Ÿè®¾ç½®** (System Settings)
2. è¿›å…¥ **é€šç”¨** (General) â†’ **éš”ç©ºæ’­æ”¾æ¥æ”¶å™¨** (AirPlay Receiver)
3. å…³é—­ **éš”ç©ºæ’­æ”¾æ¥æ”¶å™¨** å¼€å…³
4. é‡æ–°è¿è¡Œ `npm run dev`

### æ–¹æ¡ˆ 2ï¼šä½¿ç”¨å…¶ä»–ç«¯å£

ä¸´æ—¶ä½¿ç”¨ç«¯å£ 3000 è¿è¡Œå¼€å‘æœåŠ¡å™¨ï¼š

```bash
PORT=3000 npm run dev
```

ç„¶åè®¿é—®ï¼š`http://localhost:3000`

## éªŒè¯ç«¯å£å¯ç”¨æ€§

æ£€æŸ¥ç«¯å£ 5000 æ˜¯å¦è¢«å ç”¨ï¼š
```bash
lsof -i:5000
```

å¦‚æœæ˜¾ç¤º `ControlCe` è¿›ç¨‹ï¼Œè¯´æ˜æ˜¯ AirPlay Receiverã€‚

## Supabase Auth è¿ç§»æµ‹è¯•æŒ‡å—

### æ•°æ®åº“è¿ç§»çŠ¶æ€ âœ…

å·²å®Œæˆï¼š
- âœ… æ·»åŠ äº† `supabase_user_id` å’Œ `migrated_to_supabase` å­—æ®µ
- âœ… åˆ›å»ºäº†æ•°æ®åº“ç´¢å¼•
- âœ… åˆ›å»ºäº†è‡ªåŠ¨åŒæ­¥è§¦å‘å™¨
- âœ… å½“å‰çŠ¶æ€ï¼š0ä¸ªå·²è¿ç§»ç”¨æˆ·ï¼Œ2ä¸ªå¾…è¿ç§»ç”¨æˆ·

### æµ‹è¯•æ­¥éª¤

#### 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# è§£å†³ç«¯å£å†²çªå
npm run dev
```

æœåŠ¡å™¨åº”è¯¥æ˜¾ç¤ºï¼š
```
Connected to database successfully
Server running on http://localhost:5000
```

#### 2. æµ‹è¯•ç°æœ‰ç”¨æˆ·è¿ç§»ï¼ˆå…³é”®æµ‹è¯•ï¼‰

**å‡†å¤‡å·¥ä½œï¼š**
- ä½ éœ€è¦2ä¸ªç°æœ‰ç”¨æˆ·ä¹‹ä¸€çš„é‚®ç®±å’Œå¯†ç 
- è¿™äº›ç”¨æˆ·åº”è¯¥åœ¨æ•°æ®åº“ä¸­æœ‰ `password_hash` å­—æ®µ

**æµ‹è¯•æµç¨‹ï¼š**

1. æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:5000/login`
2. è¾“å…¥ç°æœ‰ç”¨æˆ·çš„é‚®ç®±å’Œå¯†ç 
3. ç‚¹å‡»"ç™»å½•"

**æœŸæœ›ç»“æœï¼š**
- âœ… æ˜¾ç¤ºæ¶ˆæ¯ï¼š"è´¦å·å·²å‡çº§ï¼Account upgraded to new authentication system"
- âœ… æˆåŠŸè·³è½¬åˆ° `/levels` é¡µé¢
- âœ… æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
  ```
  ğŸ” Attempting Supabase Auth login for: user@example.com
  ğŸ”„ Checking old system for: user@example.com
  ğŸ” Verifying old password for: user@example.com
  ğŸš€ Migrating user user@example.com to Supabase Auth...
  ğŸ”— Linking user@example.com to Supabase user ID: xxx-xxx-xxx
  âœ… Successfully migrated user@example.com to Supabase Auth
  ```

4. **ç¬¬äºŒæ¬¡ç™»å½•æµ‹è¯•ï¼š**
   - é€€å‡ºç™»å½•
   - å†æ¬¡ç”¨ç›¸åŒè´¦å·ç™»å½•
   - æœŸæœ›ç»“æœï¼šæ˜¾ç¤º"ç™»å½•æˆåŠŸï¼æ¬¢è¿å›æ¥"ï¼ˆæ™®é€šç™»å½•æ¶ˆæ¯ï¼Œä¸å†è¿ç§»ï¼‰

#### 3. éªŒè¯ Supabase Dashboard

1. è®¿é—®ï¼šhttps://supabase.com/dashboard/project/hsfthqchyupkbmazcuis
2. å¯¼èˆªåˆ°ï¼š**Authentication** â†’ **Users**
3. åº”è¯¥çœ‹åˆ°åˆšæ‰è¿ç§»çš„ç”¨æˆ·
4. å¯¼èˆªåˆ°ï¼š**Table Editor** â†’ **users**
5. æ£€æŸ¥è¯¥ç”¨æˆ·çš„å­—æ®µï¼š
   - `supabase_user_id` åº”è¯¥æœ‰å€¼ï¼ˆUUIDï¼‰
   - `migrated_to_supabase` åº”è¯¥ä¸º `true`
   - `password_hash` åº”è¯¥ä¸º `null`ï¼ˆå·²æ¸…é™¤ï¼‰

#### 4. æµ‹è¯•æ–°ç”¨æˆ·æ³¨å†Œ

1. è®¿é—®ï¼š`http://localhost:5000/register`
2. å¡«å†™æ³¨å†Œè¡¨å•ï¼š
   - é‚®ç®±ï¼š`test-new@example.com`
   - åå­—ï¼š`Test`
   - å§“æ°ï¼š`User`ï¼ˆå¯é€‰ï¼‰
   - å¯†ç ï¼š`password123456`
   - ç¡®è®¤å¯†ç ï¼š`password123456`
3. ç‚¹å‡»"æ³¨å†Œ"

**æœŸæœ›ç»“æœï¼š**
- âœ… æ˜¾ç¤ºï¼š"æ³¨å†ŒæˆåŠŸï¼æ‚¨çš„è´¦å·å·²åˆ›å»ºï¼Œè¯·ç™»å½•"
- âœ… è·³è½¬åˆ° `/login` æˆ– `/levels`
- âœ… åœ¨ Supabase Dashboard â†’ Authentication ä¸­çœ‹åˆ°æ–°ç”¨æˆ·
- âœ… åœ¨ Supabase Dashboard â†’ Table Editor â†’ users ä¸­çœ‹åˆ°è‡ªåŠ¨åˆ›å»ºçš„ç”¨æˆ·èµ„æ–™

#### 5. éªŒè¯è¿ç§»è¿›åº¦

åœ¨ Supabase SQL Editor ä¸­è¿è¡Œï¼š

```sql
SELECT
  COUNT(*) FILTER (WHERE migrated_to_supabase = true) as migrated_users,
  COUNT(*) FILTER (WHERE migrated_to_supabase = false) as pending_users,
  COUNT(*) as total_users
FROM public.users;
```

**æœŸæœ›ç»“æœï¼ˆå®Œæˆæ‰€æœ‰æµ‹è¯•åï¼‰ï¼š**
- `migrated_users`: 1ï¼ˆæˆ–æ›´å¤šï¼Œå–å†³äºæµ‹è¯•äº†å¤šå°‘ç”¨æˆ·ï¼‰
- `pending_users`: 1ï¼ˆæˆ–æ›´å°‘ï¼‰
- `total_users`: 3ï¼ˆ2ä¸ªåŸæœ‰ + 1ä¸ªæ–°æ³¨å†Œï¼‰

### å¸¸è§é—®é¢˜æ’æŸ¥

#### é—®é¢˜ï¼šç™»å½•è¿”å› 401

**æ£€æŸ¥ï¼š**
1. æœåŠ¡å™¨æ—¥å¿—ä¸­çš„å…·ä½“é”™è¯¯ä¿¡æ¯
2. `.env.local` æ˜¯å¦åŒ…å«æ‰€æœ‰ Supabase å‡­è¯
3. æ•°æ®åº“è¿ç§»æ˜¯å¦æˆåŠŸå®Œæˆ
4. ç”¨æˆ·æ˜¯å¦æœ‰ `password_hash` å­—æ®µ

#### é—®é¢˜ï¼šæ³¨å†Œå¤±è´¥

**æ£€æŸ¥ï¼š**
1. æ•°æ®åº“è§¦å‘å™¨æ˜¯å¦åˆ›å»ºæˆåŠŸ
2. Supabase Auth æ˜¯å¦å·²å¯ç”¨
3. æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯

#### é—®é¢˜ï¼š"Supabase Admin not configured"

**è§£å†³ï¼š**
1. æ£€æŸ¥ `.env.local` ä¸­çš„ `SUPABASE_SERVICE_ROLE_KEY`
2. é‡å¯å¼€å‘æœåŠ¡å™¨ï¼š`npm run dev`

### æˆåŠŸæ ‡å‡†

è¿ç§»æˆåŠŸçš„æ ‡å¿—ï¼š
- âœ… æ•°æ®åº“è¿ç§» SQL æ— é”™è¯¯æ‰§è¡Œ
- âœ… ç°æœ‰ç”¨æˆ·å¯ä»¥ç™»å½•å¹¶çœ‹åˆ°"è´¦å·å·²å‡çº§"æ¶ˆæ¯
- âœ… ç¬¬äºŒæ¬¡ç™»å½•æ˜¾ç¤ºæ™®é€šç™»å½•æ¶ˆæ¯
- âœ… æ–°ç”¨æˆ·å¯ä»¥æˆåŠŸæ³¨å†Œ
- âœ… æ‰€æœ‰ç”¨æˆ·åœ¨ Supabase Authentication ä¸­å¯è§
- âœ… ç”¨æˆ·èµ„æ–™åœ¨ public.users è¡¨ä¸­è‡ªåŠ¨åˆ›å»º
- âœ… æ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼ˆlevel, exp, streakç­‰ï¼‰ä¿æŒå®Œæ•´

### ä¸‹ä¸€æ­¥

æµ‹è¯•å®Œæˆåï¼š
1. âœ… æäº¤æ‰€æœ‰æ›´æ”¹åˆ° git
2. âœ… éƒ¨ç½²åˆ° Vercel ç”Ÿäº§ç¯å¢ƒ
3. âœ… åœ¨ç”Ÿäº§ç¯å¢ƒè¿›è¡Œç›¸åŒæµ‹è¯•
4. âœ… ç›‘æ§ç”Ÿäº§ç¯å¢ƒçš„è¿ç§»è¿›åº¦

---

**å½“å‰é˜¶æ®µï¼š** ç­‰å¾…ç«¯å£å†²çªè§£å†³åå¼€å§‹æµ‹è¯•
**é¢„è®¡æ—¶é—´ï¼š** 10-15åˆ†é’Ÿå®Œæˆæ‰€æœ‰æµ‹è¯•
