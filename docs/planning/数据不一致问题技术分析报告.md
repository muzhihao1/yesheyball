# æ•°æ®ä¸ä¸€è‡´é—®é¢˜æŠ€æœ¯åˆ†ææŠ¥å‘Š

**åˆ›å»ºæ—¶é—´**: 2025-01-17
**é—®é¢˜çº§åˆ«**: P0 (æœ€é«˜ä¼˜å…ˆçº§)
**åˆ†æå·¥å…·**: Ultra MCP + Code Analysis

---

## ğŸ“Š é—®é¢˜æ€»ç»“

### P0-1: æ¸…å°èƒ½åŠ›åˆ†æ˜¾ç¤ºä¸ä¸€è‡´ ğŸ”´

**ç”¨æˆ·åé¦ˆ**:
- ä¸ªäººæ¡£æ¡ˆæ˜¾ç¤º"æ¸…å°èƒ½åŠ›æ€»åˆ†: 20"
- èƒ½åŠ›é›·è¾¾å›¾æ˜¾ç¤º"å‡†åº¦: 67, æ†æ³•: 0, èµ°ä½: 0, å‘åŠ›: 0, ç­–ç•¥: 0"
- é€»è¾‘å†²çª: 67 + 0 + 0 + 0 + 0 â‰  20

**æ ¹æœ¬åŸå› ** (å·²éªŒè¯):

1. **æ•°æ®åº“schemaä¸ä¸šåŠ¡é€»è¾‘ä¸åŒ¹é…**:
   ```typescript
   // shared/schema.ts:51 - æ•°æ®åº“å®šä¹‰
   clearanceScore: integer("clearance_score").notNull().default(0),
   // æ³¨é‡Šè¯´: æ¸…å°èƒ½åŠ›æ€»åˆ† (0-100) âš ï¸ é”™è¯¯çš„èŒƒå›´å®šä¹‰
   ```

2. **å®é™…è®¡ç®—é€»è¾‘ä½¿ç”¨ç®€å•æ±‚å’Œ**:
   ```typescript
   // server/abilityScoreEngine.ts:130-139
   export function calculateClearanceScore(scores: AbilityScores): number {
     const simpleSum =
       scores.accuracy_score +      // 0-100
       scores.spin_score +           // 0-100
       scores.positioning_score +    // 0-100
       scores.power_score +          // 0-100
       scores.strategy_score;        // 0-100

     return Math.round(simpleSum);  // æœ€å¤§500åˆ†ï¼
   }

   // æ³¨é‡Šæ˜ç¡®è¯´æ˜ï¼šæ—§å…¬å¼æ˜¯åŠ æƒå¹³å‡ï¼ˆæœ€å¤§100åˆ†ï¼‰ï¼Œæ–°å…¬å¼æ˜¯ç®€å•æ±‚å’Œï¼ˆæœ€å¤§500åˆ†ï¼‰
   ```

3. **å‰ç«¯æ˜¾ç¤ºæ··ä¹±**:
   - `client/src/pages/profile.tsx:160` æ˜¾ç¤º `{(userStats as any)?.currentStreak || 0}å¤©` (è¿ç»­è®­ç»ƒå¤©æ•°)
   - `client/src/pages/profile.tsx:168` æ˜¾ç¤º `æ€»è®­ç»ƒ: {(userStats as any)?.totalDays || 0}å¤©`
   - ä¸¤ä¸ªæ•°æ®å¯èƒ½æ¥è‡ªä¸åŒæ¥æº

**æ•°æ®æµåˆ†æ**:
```
ç”¨æˆ·å®Œæˆè®­ç»ƒ
    â†“
server/abilityScoreEngine.ts (è®¡ç®—æ–°åˆ†æ•°)
    â†“
calculateClearanceScore() â†’ ç®€å•æ±‚å’Œ (0-500)
    â†“
æ›´æ–°æ•°æ®åº“: UPDATE users SET clearance_score = <500åˆ†åˆ¶çš„å€¼>
    â†“
å‰ç«¯æŸ¥è¯¢: /api/v1/dashboard/summary
    â†“
è¿”å›: { clearance: user.clearanceScore } â† å¯èƒ½æ˜¯0-500çš„å€¼
    â†“
å‰ç«¯æ˜¾ç¤º: æ··æ·†äº†0-100å’Œ0-500ä¸¤ç§èŒƒå›´
```

---

### P0-2: è®­ç»ƒå¤©æ•°æ˜¾ç¤ºä¸ä¸€è‡´ ğŸ”´

**ç”¨æˆ·åé¦ˆ**:
- 90å¤©æŒ‘æˆ˜é¡µé¢: æ˜¾ç¤º "è¿ç»­è®­ç»ƒ3å¤©"
- ä¸ªäººæ¡£æ¡ˆæ¦‚è§ˆ: æ˜¾ç¤º "è¿ç»­è®­ç»ƒ3å¤©"
- ä¸ªäººæ¡£æ¡ˆç»Ÿè®¡å¡ç‰‡: æ˜¾ç¤º "è¿ç»­è®­ç»ƒ1å¤©"

**æ ¹æœ¬åŸå› ** (å·²éªŒè¯):

1. **æ•°æ®åº“å­˜å‚¨å¤šä¸ªè®­ç»ƒå¤©æ•°å­—æ®µ**:
   ```typescript
   // shared/schema.ts:33-34, 67-68
   streak: integer("streak").notNull().default(0),                          // è¿ç»­è®­ç»ƒå¤©æ•°
   totalDays: integer("total_days").notNull().default(0),                   // æ€»è®­ç»ƒå¤©æ•°
   challengeCompletedDays: integer("challenge_completed_days").default(0),  // 90å¤©æŒ‘æˆ˜å·²å®Œæˆå¤©æ•°
   ```

2. **ä¸¤ä¸ªè®­ç»ƒç³»ç»Ÿæ•°æ®æœªç»Ÿä¸€**:
   ```typescript
   // server/routes.ts:247-275 - åˆå¹¶ä¸¤ä¸ªç³»ç»Ÿçš„è®­ç»ƒè®°å½•
   // System 1: Skills Library (training_sessions table)
   const skillsLibrarySessions = await storage.getUserTrainingSessions(userId);

   // System 2: 90-Day Challenge (ninety_day_training_records table)
   const ninetyDaySessions = await db!
     .select({ /* ... */ })
     .from(ninetyDayTrainingRecords)
     .where(eq(ninetyDayTrainingRecords.userId, userId));

   // Merge both systems
   const allCompletedSessions = [
     ...completedSkillsSessions.map(/* ... */),
     ...ninetyDaySessions.map(/* ... */)
   ];

   const streakData = calculateTrainingStreak(allCompletedSessions);
   ```

3. **å‰ç«¯ä½¿ç”¨å¤šä¸ªæ•°æ®æº**:
   ```typescript
   // client/src/pages/profile.tsx:40-43
   const { data: userStats } = useQuery({
     queryKey: ["/api/user/streak"],  // â† æ•°æ®æº1
     enabled: !!user,
   });

   // client/src/pages/profile.tsx:160 - æ˜¾ç¤ºè¿ç»­è®­ç»ƒå¤©æ•°
   {(userStats as any)?.currentStreak || 0}å¤©

   // client/src/pages/profile.tsx:168 - æ˜¾ç¤ºæ€»è®­ç»ƒå¤©æ•°
   æ€»è®­ç»ƒ: {(userStats as any)?.totalDays || 0}å¤©  // â† å¯èƒ½ä¸currentStreakæ¥æºä¸åŒ
   ```

**é—®é¢˜**:
- `user.streak` å­—æ®µå¯èƒ½æœªå®æ—¶æ›´æ–°
- `/api/user/streak` ç«¯ç‚¹åŠ¨æ€è®¡ç®—ï¼Œä½†ç»“æœæœªåŒæ­¥åˆ° `user.streak` å­—æ®µ
- å‰ç«¯æ··ç”¨äº†ç”¨æˆ·å¯¹è±¡çš„ `streak` å’Œ API åŠ¨æ€è®¡ç®—çš„ `currentStreak`

---

## ğŸ” æ·±å±‚æ¬¡æŠ€æœ¯é—®é¢˜

### é—®é¢˜1: Schemaä¸ä¸šåŠ¡é€»è¾‘è„±èŠ‚

**å½“å‰çŠ¶æ€**:
- **æ•°æ®åº“å®šä¹‰**: `clearanceScore` å­—æ®µç±»å‹ `integer`ï¼Œæ³¨é‡Šè¯´ "0-100"
- **å®é™…ä¸šåŠ¡é€»è¾‘**: è®¡ç®—å…¬å¼è¾“å‡º "0-500"
- **åæœ**: ä»»ä½•æ–°å¼€å‘è€…çœ‹åˆ°schemaä¼šè®¤ä¸ºæ˜¯0-100ï¼Œå¯¼è‡´é”™è¯¯å‡è®¾

**å½±å“èŒƒå›´**:
- âŒ å‰ç«¯UIè®¾è®¡ï¼ˆè¿›åº¦æ¡ã€é›·è¾¾å›¾çš„scaleè®¾ç½®é”™è¯¯ï¼‰
- âŒ æ•°æ®éªŒè¯ï¼ˆå¯èƒ½æ‹’ç»åˆæ³•çš„500åˆ†å€¼ï¼‰
- âŒ å¯ç»´æŠ¤æ€§ï¼ˆæ–°å¼€å‘è€…ä¼šå›°æƒ‘ï¼‰

### é—®é¢˜2: åŒè®­ç»ƒç³»ç»Ÿæ•°æ®å­¤å²›

**ä¸¤ä¸ªè®­ç»ƒç³»ç»Ÿ**:
1. **æŠ€èƒ½åº“ç³»ç»Ÿ** (Skills Library)
   - è¡¨: `training_sessions`
   - è®°å½•: ç”¨æˆ·å®Œæˆçš„æŠ€èƒ½åº“è®­ç»ƒ

2. **90å¤©æŒ‘æˆ˜ç³»ç»Ÿ** (90-Day Challenge)
   - è¡¨: `ninety_day_training_records`
   - è®°å½•: ç”¨æˆ·å®Œæˆçš„90å¤©è¯¾ç¨‹è®­ç»ƒ

**æ•°æ®å­¤å²›é—®é¢˜**:
- ä¸¤å¥—ç³»ç»Ÿå„è‡ªè®°å½•è®­ç»ƒæ•°æ®
- è®­ç»ƒå¤©æ•°éœ€è¦**è¿è¡Œæ—¶åˆå¹¶**æ‰èƒ½å¾—åˆ°å‡†ç¡®å€¼
- ç”¨æˆ·å¯¹è±¡çš„ `streak` å­—æ®µæœªå®æ—¶åŒæ­¥
- å¯¼è‡´å‰ç«¯æ˜¾ç¤ºä¸ä¸€è‡´

### é—®é¢˜3: ç¼ºå°‘æ•°æ®ä¸€è‡´æ€§ä¿éšœ

**å½“å‰æ¶æ„ç¼ºé™·**:
```
ç”¨æˆ·å®Œæˆè®­ç»ƒ
    â†“
æ’å…¥ training_sessions / ninety_day_training_records âœ…
    â†“
æ›´æ–° user.accuracyScore, spinScore, etc. âœ…
    â†“
æ›´æ–° user.clearanceScore âœ…
    â†“
æ›´æ–° user.streak âŒ æœªåŒæ­¥ï¼
    â†“
å¯¼è‡´: user.streak != calculateTrainingStreak(allSessions).currentStreak
```

---

## âœ… æŠ€æœ¯è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆA: ä¿®æ­£Schemaå¹¶ç»Ÿä¸€æ•°æ®æº (æ¨è) â­

#### 1. ä¿®æ­£Schemaæ–‡æ¡£ (ç«‹å³æ‰§è¡Œ)

**æ–‡ä»¶**: `shared/schema.ts:51`

**ä¿®æ”¹å‰**:
```typescript
clearanceScore: integer("clearance_score").notNull().default(0), // æ¸…å°èƒ½åŠ›æ€»åˆ† (0-100)
```

**ä¿®æ”¹å**:
```typescript
clearanceScore: integer("clearance_score").notNull().default(0), // æ¸…å°èƒ½åŠ›æ€»åˆ† (0-500, äº”ä¸ªç»´åº¦ç›¸åŠ )
```

**é¢å¤–è¯´æ˜æ³¨é‡Š**:
```typescript
// Ability Score System (5-dimension scoring for 90-day challenge)
// æ³¨æ„ï¼šæ¸…å°èƒ½åŠ›æ€»åˆ† = å‡†åº¦åˆ† + æ†æ³•åˆ† + èµ°ä½åˆ† + å‘åŠ›åˆ† + ç­–ç•¥åˆ†
// æ¯ä¸ªç»´åº¦ 0-100åˆ†ï¼Œæ€»åˆ†èŒƒå›´ 0-500åˆ†
accuracyScore: integer("accuracy_score").notNull().default(0), // å‡†åº¦åˆ† (0-100)
spinScore: integer("spin_score").notNull().default(0), // æ†æ³•åˆ† (0-100)
positioningScore: integer("positioning_score").notNull().default(0), // èµ°ä½åˆ† (0-100)
powerScore: integer("power_score").notNull().default(0), // å‘åŠ›åˆ† (0-100)
strategyScore: integer("strategy_score").notNull().default(0), // ç­–ç•¥åˆ† (0-100)
clearanceScore: integer("clearance_score").notNull().default(0), // æ¸…å°èƒ½åŠ›æ€»åˆ† (0-500, ç®€å•æ±‚å’Œ)
```

**å·¥ä½œé‡**: 10åˆ†é’Ÿ

---

#### 2. ç»Ÿä¸€å‰ç«¯UIæ˜¾ç¤ºé€»è¾‘

**é—®é¢˜**: å‰ç«¯å¯èƒ½å‡è®¾æ¸…å°èƒ½åŠ›åˆ†æ˜¯0-100ï¼Œå¯¼è‡´UIæ˜¾ç¤ºé”™è¯¯

**éœ€è¦æ£€æŸ¥å¹¶ä¿®å¤çš„ç»„ä»¶**:

**A. èƒ½åŠ›åˆ†å¡ç‰‡æ˜¾ç¤º**:
```typescript
// éœ€è¦ç¡®è®¤ï¼šclient/src/components/AbilityScoreBars.tsx
// éœ€è¦ç¡®è®¤ï¼šclient/src/components/ninety-day/AbilityScoreCards.tsx

// é¢„æœŸä¿®æ”¹ç¤ºä¾‹ï¼š
<div>
  <p>æ¸…å°èƒ½åŠ›æ€»åˆ†: {scores?.clearance} / 500</p> {/* æ˜ç¡®æ˜¾ç¤ºèŒƒå›´ */}
  <ProgressBar value={scores?.clearance} max={500} />  {/* maxæ”¹ä¸º500 */}
</div>
```

**B. é›·è¾¾å›¾scaleè°ƒæ•´**:
```typescript
// éœ€è¦ç¡®è®¤ï¼šclient/src/components/ninety-day/AbilityRadarChart.tsx

// å¦‚æœé›·è¾¾å›¾æ˜¾ç¤ºæ¸…å°èƒ½åŠ›åˆ†ï¼Œéœ€è¦å•ç‹¬scale
<RadarChart>
  {/* äº”ä¸ªç»´åº¦ä½¿ç”¨0-100 scale */}
  {/* æ¸…å°èƒ½åŠ›æ€»åˆ†å•ç‹¬æ˜¾ç¤ºï¼Œä¸æ”¾å…¥é›·è¾¾å›¾ï¼ˆå› ä¸ºæ˜¯æ±‚å’Œï¼Œä¸æ˜¯ç‹¬ç«‹ç»´åº¦ï¼‰*/}
</RadarChart>
```

**C. ä¸ªäººæ¡£æ¡ˆé¡µé¢**:
```typescript
// client/src/pages/profile.tsx
// åœ¨"èƒ½åŠ›åˆ†æ"éƒ¨åˆ†æ·»åŠ æ¸…å°èƒ½åŠ›æ€»åˆ†æ˜¾ç¤º

<div className="mb-4 p-4 bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg">
  <h3 className="text-lg font-bold mb-2">æ¸…å°èƒ½åŠ›æ€»åˆ†</h3>
  <div className="text-4xl font-bold text-purple-600">
    {abilityScores?.clearance || 0} <span className="text-lg text-gray-500">/ 500</span>
  </div>
  <p className="text-sm text-gray-600 mt-1">
    = å‡†åº¦{abilityScores?.accuracy} + æ†æ³•{abilityScores?.spin} +
      èµ°ä½{abilityScores?.positioning} + å‘åŠ›{abilityScores?.power} +
      ç­–ç•¥{abilityScores?.strategy}
  </p>
</div>
```

**å·¥ä½œé‡**: 1-2å°æ—¶

---

#### 3. å®æ—¶åŒæ­¥è®­ç»ƒå¤©æ•°åˆ°user.streak

**é—®é¢˜**: ç”¨æˆ·å¯¹è±¡çš„ `streak` å­—æ®µæœªå®æ—¶æ›´æ–°

**è§£å†³æ–¹æ¡ˆ**: åœ¨è®­ç»ƒè®°å½•åˆ›å»ºåï¼Œç«‹å³æ›´æ–° `user.streak`

**ä¿®æ”¹ä½ç½®**: `server/routes.ts` æˆ– `server/abilityScoreEngine.ts`

```typescript
// server/routes.ts:POST /api/ninety-day/training-records (æˆ–ç±»ä¼¼ç«¯ç‚¹)

async function handleTrainingCompletion(userId: string) {
  // 1. æ’å…¥è®­ç»ƒè®°å½•
  await insertTrainingRecord(/* ... */);

  // 2. æ›´æ–°èƒ½åŠ›åˆ†
  await updateAbilityScores(userId, /* ... */);

  // 3. âœ… æ–°å¢ï¼šé‡æ–°è®¡ç®—å¹¶æ›´æ–°streak
  const allSessions = await getAllTrainingSessions(userId); // åˆå¹¶ä¸¤ä¸ªç³»ç»Ÿ
  const streakData = calculateTrainingStreak(allSessions);

  await db.update(users)
    .set({
      streak: streakData.currentStreak,
      totalDays: streakData.totalDays,
    })
    .where(eq(users.id, userId));
}
```

**å¤‡é€‰æ–¹æ¡ˆ**: åˆ›å»ºç»Ÿä¸€çš„ `updateUserStats()` å‡½æ•°ï¼Œæ¯æ¬¡è®­ç»ƒå®Œæˆåè°ƒç”¨

```typescript
// server/userStatsService.ts (æ–°å»ºæ–‡ä»¶)

export async function updateUserStats(userId: string) {
  // 1. åˆå¹¶ä¸¤ä¸ªè®­ç»ƒç³»ç»Ÿçš„æ•°æ®
  const skillsSessions = await storage.getUserTrainingSessions(userId);
  const ninetyDaySessions = await fetchNinetyDayRecords(userId);

  const allSessions = [...skillsSessions, ...ninetyDaySessions];

  // 2. è®¡ç®—æœ€æ–°çš„streakæ•°æ®
  const streakData = calculateTrainingStreak(allSessions);

  // 3. æ›´æ–°ç”¨æˆ·å¯¹è±¡
  await db.update(users)
    .set({
      streak: streakData.currentStreak,
      totalDays: streakData.totalDays,
      lastActiveAt: new Date(),
    })
    .where(eq(users.id, userId));

  return streakData;
}
```

**è°ƒç”¨æ—¶æœº**:
- ç”¨æˆ·å®ŒæˆæŠ€èƒ½åº“è®­ç»ƒ â†’ è°ƒç”¨ `updateUserStats()`
- ç”¨æˆ·å®Œæˆ90å¤©æŒ‘æˆ˜è®­ç»ƒ â†’ è°ƒç”¨ `updateUserStats()`

**å·¥ä½œé‡**: 2-3å°æ—¶

---

#### 4. å‰ç«¯ç»Ÿä¸€æ•°æ®æº

**é—®é¢˜**: å‰ç«¯æ··ç”¨å¤šä¸ªæ•°æ®æºæ˜¾ç¤ºè®­ç»ƒå¤©æ•°

**è§£å†³æ–¹æ¡ˆ**: ç»Ÿä¸€ä½¿ç”¨ `useDashboardSummary()` hook

```typescript
// client/src/pages/profile.tsx

// âŒ æ—§ä»£ç ï¼šæ··ç”¨å¤šä¸ªæ•°æ®æº
const { data: userStats } = useQuery({ queryKey: ["/api/user/streak"] });
<div>{(userStats as any)?.currentStreak || 0}å¤©</div>
<div>æ€»è®­ç»ƒ: {(userStats as any)?.totalDays || 0}å¤©</div>

// âœ… æ–°ä»£ç ï¼šç»Ÿä¸€ä½¿ç”¨dashboardData
const { data: dashboardData } = useDashboardSummary();
<div>{dashboardData.ninetyDayChallenge.completedDays}å¤©</div>  // å•ä¸€æ•°æ®æº
<div>æ€»è®­ç»ƒ: {user.totalDays}å¤©</div>  // ä»åŒæ­¥åçš„userå¯¹è±¡è¯»å–
```

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶**:
- `client/src/pages/profile.tsx`
- `client/src/components/dashboard/NinetyDayChallengeCard.tsx`
- `client/src/components/ninety-day/StatsPanel.tsx`

**å·¥ä½œé‡**: 1å°æ—¶

---

### æ–¹æ¡ˆB: ä»…ä¿®æ­£å‰ç«¯æ˜¾ç¤º (ä¸´æ—¶æ–¹æ¡ˆ)

**ä¸æ¨èç†ç”±**:
- æœªè§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜
- åªæ˜¯"æ©ç›–"äº†é—®é¢˜ï¼Œæœªä¿®å¤æ ¹æœ¬åŸå› 
- åç»­ä»å¯èƒ½å‡ºç°æ–°çš„ä¸ä¸€è‡´

**å¦‚æœå¿…é¡»ä½¿ç”¨**:
1. å‰ç«¯æ˜¾ç¤ºæ—¶ç»Ÿä¸€ä» `/api/v1/dashboard/summary` è·å–æ•°æ®
2. æ˜¾ç¤ºæ¸…å°èƒ½åŠ›åˆ†æ—¶æ˜ç¡®æ ‡æ³¨ " / 500"
3. ä¸ä¿®æ”¹åç«¯é€»è¾‘

**å·¥ä½œé‡**: 0.5-1å°æ—¶

---

## ğŸ“‹ å®æ–½è®¡åˆ’ (æ¨èæ–¹æ¡ˆA)

### ç¬¬1æ­¥: ä¿®æ­£Schemaæ–‡æ¡£ (10åˆ†é’Ÿ)
- [x] ä¿®æ”¹ `shared/schema.ts:51` æ³¨é‡Š
- [x] æ·»åŠ èƒ½åŠ›åˆ†ç³»ç»Ÿçš„è¯¦ç»†è¯´æ˜æ³¨é‡Š

### ç¬¬2æ­¥: ä¿®å¤å‰ç«¯UIæ˜¾ç¤º (1-2å°æ—¶)
- [ ] æ£€æŸ¥ `AbilityScoreBars.tsx` - ç¡®è®¤è¿›åº¦æ¡maxå€¼
- [ ] æ£€æŸ¥ `AbilityScoreCards.tsx` - ç¡®è®¤å¡ç‰‡æ˜¾ç¤ºèŒƒå›´
- [ ] æ£€æŸ¥ `AbilityRadarChart.tsx` - ç¡®è®¤æ˜¯å¦åŒ…å«æ¸…å°èƒ½åŠ›åˆ†
- [ ] ä¿®æ”¹ `profile.tsx` - æ·»åŠ æ¸…å°èƒ½åŠ›æ€»åˆ†æ˜¾ç¤º
- [ ] ä¿®æ”¹ `NinetyDayChallenge.tsx` - ç¡®è®¤headeræ˜¾ç¤º

### ç¬¬3æ­¥: å®æ—¶åŒæ­¥è®­ç»ƒå¤©æ•° (2-3å°æ—¶)
- [ ] åˆ›å»º `server/userStatsService.ts` - ç»Ÿä¸€statsæ›´æ–°é€»è¾‘
- [ ] ä¿®æ”¹è®­ç»ƒè®°å½•ç«¯ç‚¹ - å®Œæˆåè°ƒç”¨ `updateUserStats()`
- [ ] æµ‹è¯•ä¸¤ä¸ªè®­ç»ƒç³»ç»Ÿçš„æ•°æ®åŒæ­¥

### ç¬¬4æ­¥: ç»Ÿä¸€å‰ç«¯æ•°æ®æº (1å°æ—¶)
- [ ] ä¿®æ”¹ `profile.tsx` - ä½¿ç”¨ `useDashboardSummary()`
- [ ] ç§»é™¤æ—§çš„ `useQuery("/api/user/streak")` è°ƒç”¨
- [ ] ç»Ÿä¸€æ‰€æœ‰é¡µé¢çš„æ•°æ®æº

### ç¬¬5æ­¥: éªŒè¯æµ‹è¯• (1å°æ—¶)
- [ ] å®Œæˆä¸€æ¬¡æŠ€èƒ½åº“è®­ç»ƒï¼ŒéªŒè¯streakæ›´æ–°
- [ ] å®Œæˆä¸€æ¬¡90å¤©æŒ‘æˆ˜è®­ç»ƒï¼ŒéªŒè¯streakæ›´æ–°
- [ ] åˆ·æ–°é¡µé¢ï¼Œç¡®è®¤æ‰€æœ‰åœ°æ–¹æ˜¾ç¤ºä¸€è‡´
- [ ] æ£€æŸ¥æ¸…å°èƒ½åŠ›åˆ†æ˜¾ç¤ºèŒƒå›´æ­£ç¡®

**æ€»å·¥ä½œé‡**: çº¦ 5-7å°æ—¶

---

## ğŸ¯ éªŒè¯æ¸…å•

ä¿®å¤å®Œæˆåï¼ŒéªŒè¯ä»¥ä¸‹å†…å®¹ï¼š

### æ¸…å°èƒ½åŠ›åˆ†éªŒè¯
- [ ] Schemaæ³¨é‡Šæ˜ç¡®è¯´æ˜ "0-500åˆ†åˆ¶"
- [ ] å‰ç«¯æ‰€æœ‰æ˜¾ç¤ºä½ç½®éƒ½æ ‡æ³¨ " / 500"
- [ ] è¿›åº¦æ¡maxå€¼è®¾ç½®ä¸º500
- [ ] é›·è¾¾å›¾ä¸åŒ…å«æ¸…å°èƒ½åŠ›åˆ†ï¼ˆæˆ–å•ç‹¬scaleï¼‰
- [ ] ä¸ªäººæ¡£æ¡ˆæ˜¾ç¤ºæ¸…å°èƒ½åŠ›åˆ†æ‹†è§£å…¬å¼

### è®­ç»ƒå¤©æ•°éªŒè¯
- [ ] å®ŒæˆæŠ€èƒ½åº“è®­ç»ƒåï¼Œ`user.streak` ç«‹å³æ›´æ–°
- [ ] å®Œæˆ90å¤©æŒ‘æˆ˜è®­ç»ƒåï¼Œ`user.streak` ç«‹å³æ›´æ–°
- [ ] ä¸ªäººæ¡£æ¡ˆå„å¤„æ˜¾ç¤ºçš„è®­ç»ƒå¤©æ•°ä¸€è‡´
- [ ] 90å¤©æŒ‘æˆ˜é¡µé¢æ˜¾ç¤ºçš„è®­ç»ƒå¤©æ•°ä¸€è‡´
- [ ] åˆ·æ–°é¡µé¢åæ•°æ®ä¸å˜

### æ•°æ®ä¸€è‡´æ€§éªŒè¯
- [ ] `/api/v1/dashboard/summary` è¿”å›æ­£ç¡®æ•°æ®
- [ ] `useAbilityScores()` hookè¿”å›æ­£ç¡®æ•°æ®
- [ ] æ‰€æœ‰å‰ç«¯ç»„ä»¶ä½¿ç”¨ç»Ÿä¸€æ•°æ®æº
- [ ] æ— æ§åˆ¶å°è­¦å‘Šæˆ–é”™è¯¯æ—¥å¿—

---

## ğŸš¨ é£é™©ä¸æ³¨æ„äº‹é¡¹

### é£é™©1: æ—§æ•°æ®å…¼å®¹æ€§

**é—®é¢˜**: ç°æœ‰ç”¨æˆ·æ•°æ®åº“ä¸­çš„ `clearanceScore` å€¼å¯èƒ½æ˜¯æ—§å…¬å¼è®¡ç®—çš„ï¼ˆ0-100èŒƒå›´ï¼‰

**ç¼“è§£æªæ–½**:
```typescript
// æ·»åŠ æ•°æ®è¿ç§»è„šæœ¬: server/scripts/migrateClearanceScore.ts

async function migrateClearanceScores() {
  const allUsers = await db.select().from(users);

  for (const user of allUsers) {
    // æ£€æµ‹æ˜¯å¦æ˜¯æ—§æ•°æ®ï¼ˆclearanceScore <= 100 ä½†å…¶ä»–åˆ†æ•°æœ‰å€¼ï¼‰
    if (user.clearanceScore <= 100 &&
        (user.accuracyScore > 0 || user.spinScore > 0)) {
      // é‡æ–°è®¡ç®—
      const newClearanceScore =
        user.accuracyScore +
        user.spinScore +
        user.positioningScore +
        user.powerScore +
        user.strategyScore;

      await db.update(users)
        .set({ clearanceScore: newClearanceScore })
        .where(eq(users.id, user.id));

      console.log(`Migrated user ${user.id}: ${user.clearanceScore} â†’ ${newClearanceScore}`);
    }
  }
}
```

### é£é™©2: UIé€‚é…

**é—®é¢˜**: 500åˆ†åˆ¶éœ€è¦UIç»„ä»¶æ”¯æŒæ›´å¤§çš„èŒƒå›´

**æ£€æŸ¥æ¸…å•**:
- [ ] è¿›åº¦æ¡ç»„ä»¶æ”¯æŒmax=500
- [ ] æ•°å­—æ˜¾ç¤ºä¸ä¼šæº¢å‡ºå®¹å™¨
- [ ] ç§»åŠ¨ç«¯æ˜¾ç¤ºæ­£å¸¸
- [ ] é¢œè‰²æ¢¯åº¦æ­£ç¡®ï¼ˆ0-100/200/300/400/500ï¼‰

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³ç¡®è®¤**:
   - [ ] æ‚¨åŒæ„ä½¿ç”¨æ–¹æ¡ˆAï¼ˆä¿®æ­£Schemaå¹¶ç»Ÿä¸€æ•°æ®æºï¼‰ï¼Ÿ
   - [ ] è¿˜æ˜¯é€‰æ‹©æ–¹æ¡ˆBï¼ˆä»…ä¿®æ­£å‰ç«¯æ˜¾ç¤ºï¼‰ï¼Ÿ
   - [ ] æ˜¯å¦éœ€è¦æ‰§è¡Œæ•°æ®è¿ç§»è„šæœ¬ï¼Ÿ

2. **å¼€å§‹å®æ–½**:
   - [ ] æˆ‘ç«‹å³å¼€å§‹æ‰§è¡Œç¬¬1æ­¥ï¼ˆä¿®æ­£Schemaæ–‡æ¡£ï¼‰
   - [ ] æŒ‰é¡ºåºå®Œæˆç¬¬2-5æ­¥
   - [ ] æ¯å®Œæˆä¸€æ­¥æäº¤ä¸€æ¬¡git commit

3. **æŒç»­è·Ÿè¸ª**:
   - [ ] ä½¿ç”¨TodoWriteå·¥å…·è·Ÿè¸ªæ¯ä¸ªæ­¥éª¤
   - [ ] é‡åˆ°é—®é¢˜ç«‹å³å‘æ‚¨æŠ¥å‘Š
   - [ ] å®Œæˆåç”ŸæˆéªŒè¯æŠ¥å‘Š

---

**è¯·ç¡®è®¤æ˜¯å¦å¼€å§‹å®æ–½æ–¹æ¡ˆAï¼Ÿ** ğŸš€
