# 耶氏台球网站完整改进方案

## 📋 方案概述

基于《耶氏台球网站开发完成度评估》文档，本方案将系统性解决网站存在的所有问题，分为四个阶段实施，预计总工期 **15-20个工作日**。

**当前完成度**：70%
**目标完成度**：95%（可上线运营标准）

---

## 🎯 阶段一：P0级问题修复（3-4天）

### 核心目标
修复严重影响产品定位和用户信任的关键问题，确保产品核心价值清晰传达，数据准确可信。

---

### 任务 1.1：品牌与核心卖点统一 ⭐⭐⭐⭐⭐

**优先级**：P0（最高）
**预计工时**：1天
**影响范围**：全站品牌形象、营销转化率

#### 问题分析
- **根本原因**：产品核心卖点"三个月一杆清台"未在关键位置体现
- **用户影响**：无法快速感知产品价值，品牌记忆度低
- **业务影响**：营销转化率低，竞争力弱

#### 技术方案

**1.1.1 修改网站标题和元数据**
```typescript
// client/src/index.html 或相关配置文件
<title>三个月一杆清台 - 耶氏台球科学训练系统</title>
<meta name="description" content="三个月一杆清台，科学训练体系助你快速提升台球水平" />
```

**1.1.2 修改首页主标题**
```typescript
// client/src/pages/Landing.tsx 或首页组件
- 当前：科学训练 成就台球大师
+ 修改为：三个月一杆清台
+ 副标题：耶氏台球科学训练体系
```

**1.1.3 修改导航栏品牌名称**
```typescript
// client/src/components/Header.tsx 或导航组件
- 当前：耶氏台球
+ 修改为：三个月一杆清台
```

**1.1.4 修改90天挑战页面标题**
```typescript
// client/src/pages/NinetyDayChallenge.tsx
- 当前：90天台球挑战
+ 修改为：三个月一杆清台挑战
+ 页面描述：科学训练90天，实现一杆清台目标
```

**1.1.5 统一所有页面的浏览器标题**
```typescript
// 使用 React Helmet 或类似工具
挑战页面：三个月一杆清台 - 挑战
技能库：三个月一杆清台 - 技能库
练习场：三个月一杆清台 - 练习场
个人档案：三个月一杆清台 - 我的档案
```

#### 实施步骤
1. ✅ 使用 `Grep` 搜索所有包含"耶氏台球"、"台球大师"、"90天挑战"的文件
2. ✅ 批量替换品牌文案
3. ✅ 更新页面 title 和 meta 标签
4. ✅ 测试所有页面确保文案统一

#### 验收标准
- [ ] 网站所有页面的浏览器标题包含"三个月一杆清台"
- [ ] 首页主标题突出显示"三个月一杆清台"
- [ ] 导航栏品牌名称已更新
- [ ] 90天挑战页面标题和描述已更新
- [ ] 搜索引擎预览显示正确的品牌信息

---

### 任务 1.2：修复数据不一致问题 ⭐⭐⭐⭐⭐

**优先级**：P0（最高）
**预计工时**：2-3天
**影响范围**：用户信任度、产品可信度

#### 问题分析

| 数据项 | 位置1 | 位置2 | 不一致原因（推测） |
|--------|-------|-------|-------------------|
| 能力评分 | 能力详情：准度67 | 雷达图：准度100 | 数据源不同或计算逻辑不同 |
| 连续天数 | 页面顶部：0天 | 档案：已坚持2天 | 数据刷新时机不同 |
| 技能库进度 | 成就：学习中0 | 活动：已完成2集 | 进度计算逻辑不统一 |
| 清台能力分 | 挑战页面：0分 | 档案：20分 | 数据初始化或缓存问题 |

#### 技术方案

**1.2.1 统一能力评分数据源**

**问题定位**：
```bash
# 搜索能力评分相关代码
grep -r "accuracy_score\|准度" client/src/
grep -r "AbilityScores\|ability_scores" server/
```

**修复方案**：
```typescript
// 确保所有组件使用同一个 Hook 获取数据
// client/src/hooks/useAbilityScoresForProfile.ts

export function useAbilityScoresForProfile(userId: string) {
  return useQuery({
    queryKey: ['/api/users/ability-scores', userId],
    // 统一数据源，确保能力详情和雷达图用同一份数据
  });
}

// 检查雷达图是否有额外的数据转换逻辑
// client/src/components/ninety-day/AbilityRadarChart.tsx
// 确保不对分数进行归一化或缩放
```

**1.2.2 统一连续天数数据源**

**问题定位**：
```bash
grep -r "streak\|连续.*天" client/src/
grep -r "challenge_streak\|training_streak" server/
```

**修复方案**：
```typescript
// 检查是否有多个 streak 字段
// server/schema.ts 中 users 表
- challenge_streak (90天挑战连续天数)
- training_streak (通用训练连续天数)

// 统一使用一个字段，或明确区分展示逻辑
// client/src/hooks/useAuth.ts 或 useUser.ts
// 确保所有组件从同一个用户对象获取 streak 数据
```

**1.2.3 修复技能库进度统计**

**问题定位**：
```bash
grep -r "useUserSkillProgressV3\|completedSubSkills" client/src/
```

**修复方案**：
```typescript
// client/src/pages/profile.tsx
// 检查"技能库成就"的数据来源

// 确保与技能库页面使用相同的进度计算逻辑
const { data: skillProgress } = useUserSkillProgressV3();
const completedCount = skillProgress?.reduce((sum, s) =>
  sum + s.completedSubSkills, 0) || 0;
```

**1.2.4 统一清台能力分数据源**

**修复方案**：
```typescript
// 创建统一的 Hook
// client/src/hooks/useUnifiedAbilityScores.ts

export function useUnifiedAbilityScores(userId: string) {
  const { data: abilityScores } = useAbilityScores(userId);
  const { data: challengeProgress } = useNinetyDayChallengeProgress(userId);

  // 统一返回清台能力分
  return {
    clearanceScore: abilityScores?.clearance_score ||
                    challengeProgress?.clearance_score || 0,
    // 确保所有页面使用这个 Hook
  };
}
```

#### 实施步骤
1. ✅ 逐个定位每个数据不一致的根本原因
2. ✅ 检查数据库 schema，确认字段定义
3. ✅ 统一数据源 Hook
4. ✅ 删除冗余的数据查询
5. ✅ 添加数据刷新机制（QueryClient invalidation）
6. ✅ 全面测试所有页面数据一致性

#### 验收标准
- [ ] 能力评分在"能力详情"和"雷达图"显示完全一致
- [ ] 连续天数在页面顶部和个人档案显示完全一致
- [ ] 技能库进度在成就卡片和活动列表显示完全一致
- [ ] 清台能力分在挑战页面和档案页面显示完全一致
- [ ] 所有数据在页面切换后保持一致
- [ ] 完成训练后数据能实时更新

---

## 🎯 阶段二：P1级问题修复（5-7天）

### 核心目标
完善核心功能模块，提升产品完整度，修复影响用户体验的关键问题。

---

### 任务 2.1：完善清台能力分计算逻辑 ⭐⭐⭐⭐

**优先级**：P1（高）
**预计工时**：1-2天
**影响范围**：核心指标准确性

#### 问题分析
- **当前状况**：清台能力总分显示20，但5维度分数相加应该是67
- **根本原因**：权重计算公式不明确或实现有误

#### 技术方案

**2.1.1 确认权重公式**

根据 `server/abilityScoreEngine.ts` 已有代码：
```typescript
export const CLEARANCE_WEIGHTS = {
  accuracy: 0.30,    // 准度 30%
  spin: 0.20,        // 杆法 20%
  positioning: 0.25, // 走位 25%
  power: 0.15,       // 发力 15%
  strategy: 0.10,    // 策略 10%
};

// 清台能力分 = 加权平均
clearance_score =
  accuracy × 0.30 +
  spin × 0.20 +
  positioning × 0.25 +
  power × 0.15 +
  strategy × 0.10
```

**2.1.2 验证计算是否正确**

```typescript
// 假设当前分数：准度67，其他都是0
clearance = 67 × 0.30 + 0 × 0.20 + 0 × 0.25 + 0 × 0.15 + 0 × 0.10
         = 20.1
         ≈ 20 ✅ 计算逻辑正确！
```

**结论**：清台能力分计算逻辑是正确的，问题在于**用户对加权平均不理解**。

#### 解决方案：增加用户理解性

**方案A：在界面上明确说明权重**
```typescript
// client/src/components/AbilityScoreBars.tsx

<Tooltip content="清台能力总分 = 准度×30% + 杆法×20% + 走位×25% + 发力×15% + 策略×10%">
  <div className="flex items-center gap-2">
    <Sparkles className="w-5 h-5 text-green-600" />
    <span>清台能力总分</span>
    <InfoIcon className="w-4 h-4 text-gray-400" />
  </div>
</Tooltip>
```

**方案B：显示计算过程**
```typescript
<div className="mt-2 text-sm text-gray-500">
  计算方式：
  {accuracy}×30% + {spin}×20% + {positioning}×25%
  + {power}×15% + {strategy}×10% = {clearanceScore}
</div>
```

#### 验收标准
- [ ] 清台能力分计算公式已明确展示
- [ ] 用户能理解为什么总分不是简单相加
- [ ] 文档中说明了权重设置的原因

---

### 任务 2.2：修复每日目标进度显示 ⭐⭐⭐

**优先级**：P1（高）
**预计工时**：0.5天
**影响范围**：用户对目标的感知

#### 问题分析
- **当前显示**："0/100%"、"0/200%"、"0/300%"
- **问题**：百分比不应该超过100%

#### 技术方案

**定位问题代码**：
```bash
grep -r "每日目标\|DailyGoals" client/src/
```

**修复方案**：
```typescript
// client/src/components/DailyGoalsPanel.tsx

// 原始逻辑（推测）
const progress1 = (currentMinutes / 10) * 100; // 可能超过100%

// 修改为
const progress1 = Math.min((currentMinutes / 10) * 100, 100);

// 或者改为显示实际值
显示：{currentMinutes} / 10分钟 ({Math.min(progress1, 100)}%)
```

#### 验收标准
- [ ] 进度百分比不超过100%
- [ ] 完成目标后显示100%或"已完成"
- [ ] 超额完成时有特殊显示（如"超额50%"）

---

### 任务 2.3：填充专项训练道场内容 ⭐⭐⭐⭐

**优先级**：P1（高）
**预计工时**：3-4天
**影响范围**：核心功能完整性

#### 问题分析
- **当前状况**：8个专项训练入口已存在，但点击后内容缺失
- **用户影响**：期待功能无法使用，影响满意度

#### 技术方案

**2.3.1 数据库设计**

已有表：`specialized_trainings`（专项训练类型）

需要确认：`specialized_training_plans` 表是否已存在并有数据

```bash
grep -r "specialized_training_plans\|TrainingPlan" server/
```

**2.3.2 内容填充策略**

为每个专项训练创建 **3个级别 × 3个计划 = 9个训练计划**

| 专项训练 | 入门级（3个） | 进阶级（3个） | 大师级（3个） |
|---------|-------------|-------------|-------------|
| 基本功道场 | 站位基础、握杆基础、出杆基础 | 站位进阶、握杆进阶、出杆进阶 | 站位大师、握杆大师、出杆大师 |
| 准度训练营 | 直线准度、角度准度、距离准度 | 复杂角度、远距离、组合准度 | 极限准度、盲打准度、竞技准度 |
| ... | ... | ... | ... |

**2.3.3 数据结构示例**

```sql
-- 示例：基本功道场 - 站位基础
INSERT INTO specialized_training_plans (
  training_id,
  title,
  difficulty,
  estimated_time_minutes,
  content,
  xp_reward
) VALUES (
  'basic-skills-dojo-id',
  '站位与重心控制基础',
  '入门',
  20,
  '{
    "objectives": ["掌握正确站位姿势", "建立稳定重心"],
    "steps": [
      "双脚与肩同宽，前后脚距约一个脚掌",
      "重心放在前脚掌，后脚跟略抬起",
      "身体前倾约45度，保持平衡"
    ],
    "successCriteria": ["能保持站位30秒不晃动", "击球10次站位不变"],
    "commonMistakes": ["双脚站得太宽或太窄", "重心后仰"],
    "tips": "想象自己是一座稳定的三角架"
  }'::jsonb,
  50
);
```

**2.3.4 前端展示逻辑**

```typescript
// client/src/pages/tasks.tsx 已有的训练计划列表逻辑
// 确保：
1. 点击专项训练 → 显示该专项下的所有计划（按难度分组）
2. 点击具体计划 → 显示计划详情
3. 点击"开始训练" → 启动计时器和训练流程
```

#### 实施步骤
1. ✅ 确认数据库表结构
2. ✅ 编写内容填充脚本（SQL或API）
3. ✅ 为8个专项训练各创建9个计划（共72个）
4. ✅ 测试前端展示和训练流程
5. ✅ 优化UI和交互细节

#### 验收标准
- [ ] 8个专项训练都有完整的训练计划
- [ ] 每个计划有明确的目标、步骤、成功标准
- [ ] 点击"开始训练"能正常启动训练流程
- [ ] 完成训练后数据能正确记录

---

## 🎯 阶段三：P2级问题优化（4-5天）

### 核心目标
提升用户体验细节，降低学习成本，增加用户粘性。

---

### 任务 3.1：增加新手引导流程 ⭐⭐⭐⭐

**优先级**：P2（中）
**预计工时**：2-3天
**影响范围**：新用户留存率

#### 技术方案

**3.1.1 引导流程设计**

```typescript
// 使用 react-joyride 或自定义 Tour 组件

const tourSteps = [
  {
    target: '.nav-challenge',
    title: '欢迎来到"三个月一杆清台"！',
    content: '这里是你的主训练区，每天完成系统训练，90天后实现清台目标。',
    placement: 'bottom',
  },
  {
    target: '.nav-skills',
    title: '技能库',
    content: '学习傅家俊十大招和专项训练，系统提升台球技术。',
    placement: 'bottom',
  },
  {
    target: '.nav-levels',
    title: '练习场',
    content: '8级进阶体系，从启明星到超越，一步步挑战更高难度。',
    placement: 'bottom',
  },
  {
    target: '.nav-profile',
    title: '我的档案',
    content: '查看你的训练数据、成就徽章和能力分析。',
    placement: 'bottom',
  },
  {
    target: '.start-training-btn',
    title: '开始你的第一次训练！',
    content: '点击这里，开启你的清台之路。',
    placement: 'top',
  },
];
```

**3.1.2 触发条件**

```typescript
// client/src/hooks/useOnboarding.ts

export function useOnboarding() {
  const { user } = useAuth();
  const [showTour, setShowTour] = useState(false);

  useEffect(() => {
    // 新用户：训练记录数为0
    if (user && user.totalTrainingCount === 0) {
      const hasSeenTour = localStorage.getItem('hasSeenTour');
      if (!hasSeenTour) {
        setShowTour(true);
      }
    }
  }, [user]);

  const completeTour = () => {
    localStorage.setItem('hasSeenTour', 'true');
    setShowTour(false);
  };

  return { showTour, completeTour };
}
```

#### 验收标准
- [ ] 新用户首次登录自动触发引导
- [ ] 引导流程清晰易懂
- [ ] 用户可以跳过引导
- [ ] 引导完成后不再重复显示

---

### 任务 3.2：优化功能说明文案 ⭐⭐

**优先级**：P2（中）
**预计工时**：0.5天
**影响范围**：页面简洁度

#### 技术方案

**当前文案（过长）**：
```
练习场是一个游戏化的关卡系统，包含8个等级...（约100字）
```

**优化后（简短）**：
```
🎮 8级进阶体系，从启明星到超越，系统提升台球技术

[了解更多] ← 点击展开详细说明
```

#### 验收标准
- [ ] 功能说明文案精简到1-2句话
- [ ] 详细说明可折叠展开
- [ ] 页面视觉更简洁

---

### 任务 3.3：填充十大招训练单元内容 ⭐⭐⭐

**优先级**：P2（中）
**预计工时**：2天
**影响范围**：技能库完整度

#### 内容规划

为每个子技能创建训练单元：
- **理论单元**：技术原理、关键要点
- **练习单元**：分步练习、渐进难度
- **挑战单元**：综合应用、测试水平

**示例**：第一招 - 准度 - 瞄准系统

```typescript
{
  theory: {
    title: "瞄准系统理论",
    content: "瞄准是台球最基础的技能...",
    keyPoints: ["虚拟瞄准线", "三点一线", "瞄准点偏移"],
    estimatedTime: 10,
  },
  practice: {
    title: "瞄准系统练习",
    steps: [
      "练习1：直线球瞄准（10球）",
      "练习2：角度球瞄准（10球）",
      "练习3：远距离瞄准（10球）"
    ],
    estimatedTime: 30,
  },
  challenge: {
    title: "瞄准系统挑战",
    goal: "连续进10个不同角度的球",
    successRate: 80,
    estimatedTime: 20,
  }
}
```

#### 验收标准
- [ ] 每个子技能都有完整的训练单元
- [ ] 内容结构清晰，易于学习
- [ ] 点击训练单元能进入详情页

---

## 🎯 阶段四：验收与优化（2-3天）

### 核心目标
全面测试，修复遗漏问题，优化性能，准备上线。

---

### 任务 4.1：全面测试与验收 ⭐⭐⭐⭐⭐

**4.1.1 功能测试清单**
- [ ] 注册登录流程
- [ ] 90天挑战完整流程（开始训练 → 提交 → 查看反馈）
- [ ] 技能库浏览和训练
- [ ] 专项训练完整流程
- [ ] 练习场关卡挑战
- [ ] 个人档案数据准确性
- [ ] 新手引导流程

**4.1.2 数据一致性测试**
- [ ] 能力评分在所有页面显示一致
- [ ] 连续天数实时更新
- [ ] 清台能力分正确计算
- [ ] 技能库进度准确统计

**4.1.3 性能测试**
- [ ] 页面加载速度 < 2秒
- [ ] 数据查询响应时间 < 500ms
- [ ] 无明显卡顿

**4.1.4 兼容性测试**
- [ ] Chrome/Safari/Firefox
- [ ] 移动端适配
- [ ] 不同分辨率显示正常

---

### 任务 4.2：性能优化

- 图片懒加载
- 组件代码分割
- 数据缓存优化
- 数据库查询优化

---

### 任务 4.3：文档完善

- API文档
- 部署文档
- 运营手册
- 用户帮助文档

---

## 📊 总体时间规划

| 阶段 | 任务 | 预计工时 | 累计工时 |
|------|------|---------|---------|
| **阶段一** | P0级问题修复 | 3-4天 | 3-4天 |
| 1.1 | 品牌卖点统一 | 1天 | |
| 1.2 | 数据一致性修复 | 2-3天 | |
| **阶段二** | P1级问题修复 | 5-7天 | 8-11天 |
| 2.1 | 清台能力分说明 | 1-2天 | |
| 2.2 | 每日目标修复 | 0.5天 | |
| 2.3 | 专项训练内容填充 | 3-4天 | |
| **阶段三** | P2级问题优化 | 4-5天 | 12-16天 |
| 3.1 | 新手引导 | 2-3天 | |
| 3.2 | 文案优化 | 0.5天 | |
| 3.3 | 十大招内容填充 | 2天 | |
| **阶段四** | 验收与优化 | 2-3天 | 14-19天 |
| 4.1 | 全面测试 | 1-2天 | |
| 4.2 | 性能优化 | 0.5天 | |
| 4.3 | 文档完善 | 0.5-1天 | |
| **总计** | | **15-20天** | |

---

## ⚠️ 风险评估与应对

### 风险1：数据不一致问题难以定位
**影响**：可能延期1-2天
**应对**：
- 建立系统化的数据追踪机制
- 使用React Query DevTools检查数据流
- 必要时重构数据层

### 风险2：专项训练内容创作工作量大
**影响**：可能延期2-3天
**应对**：
- 优先填充核心专项训练（4个）
- 其余专项可以后续迭代
- 考虑使用模板批量生成

### 风险3：新手引导可能影响现有用户体验
**影响**：可能需要回滚
**应对**：
- 增加A/B测试开关
- 允许用户永久关闭引导
- 收集用户反馈快速迭代

---

## ✅ 最终验收标准

### 产品层面
- [ ] 核心卖点"三个月一杆清台"在关键位置突出展示
- [ ] 所有页面数据显示一致且准确
- [ ] 核心功能流程完整可用
- [ ] 新用户能快速理解产品价值和使用方法

### 技术层面
- [ ] 无严重Bug
- [ ] 页面加载速度达标
- [ ] 代码通过TypeScript检查
- [ ] 数据库查询优化完成

### 运营层面
- [ ] 产品文档齐全
- [ ] 上线准备清单完成
- [ ] 监控和日志系统就绪

---

## 🚀 后续迭代规划

完成本方案后，产品将达到 **95%完成度**，具备上线运营条件。

后续版本可考虑：
- **V2.0**：社交功能（排名、对战、分享）
- **V2.1**：付费模式（高级功能解锁）
- **V2.2**：个性化推荐算法
- **V2.3**：视频教学内容

---

## 📝 附录：关键文件清单

### 需要修改的核心文件
```
client/src/
├── pages/
│   ├── Landing.tsx           # 首页标题
│   ├── NinetyDayChallenge.tsx # 挑战页面标题
│   ├── tasks.tsx             # 技能库
│   └── profile.tsx           # 个人档案
├── components/
│   ├── Header.tsx            # 导航栏品牌
│   ├── DailyGoalsPanel.tsx   # 每日目标
│   └── AbilityScoreBars.tsx  # 能力分说明
└── hooks/
    ├── useAbilityScores.ts   # 统一数据源
    └── useOnboarding.ts      # 新手引导

server/
├── routes.ts                 # API路由
├── abilityScoreEngine.ts     # 计算逻辑
└── migrations/               # 数据库迁移
```

---

**方案制定完成时间**：2025-11-17
**方案版本**：v1.0
**制定人**：Claude Code
